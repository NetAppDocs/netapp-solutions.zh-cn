---
sidebar: sidebar 
permalink: virtualization/vsphere_ontap_recommended_esxi_host_and_other_ontap_settings.html 
keywords:  
summary:  
---
= 建议的 ESXi 主机和其他 ONTAP 设置
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


NetApp 已根据 NetApp 测试开发出一组 ESXi 主机多路径和 HBA 超时设置，用于正确处理 ONTAP 。可以使用适用于 VMware vSphere 的 ONTAP 工具轻松设置这些设置。在摘要信息板中，单击主机系统 portlet 中的编辑设置，或者右键单击 vCenter 中的主机，然后导航到 ONTAP tools > Set recommended values 。下面是当前在 9.8 版中建议的主机设置。

|===


| 主机设置 | NetApp 建议的价值 


| * ESXi 高级配置 * |  


| VMFS3.HardwareAcceleratedLocking | 保留不变（ VMware 默认值为 1 ）。 


| VMFS3.EnableBlockDelete | 保留为设置值（ VMware 默认值为 0 ，但 VMFS6 不需要此设置）。有关详细信息，请参见 VMware 知识库文章 link:https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2007427["2007427"^]。 


| * NFS 设置 * |  


| Net.TcpipHeapSize | vSphere 6.0 或更高版本，设置为 32 。所有其他 NFS 配置，设置为 30 。 


| Net.TcpipHeapMax | 对于 vSphere 6.0 及更高版本，设置为 1536 。 


| NFS.MaxVolumes | vSphere 6.0 或更高版本，设置为 256 。所有其他 NFS 配置，设置为 64 。 


| NFS41.MaxVolumes | vSphere 6.0 或更高版本，设置为 256 。 


| NFS.MaxQueueDepth | vSphere 6.0 或更高版本，设置为 128 。 


| nfs.HeartbeatMaxFailures | 对于所有 NFS 配置，均设置为 10 。 


| nfs.Heartbeat频率 | 对于所有 NFS 配置，均设置为 12 。 


| nfs.HeartbeatTimeout | 对于所有 NFS 配置，均设置为 5 。 


| SUNRPC.MaxConnPerIP | vSphere 7.0 或更高版本，设置为 128 。 


| * FC/FCoE 设置 * |  


| 路径选择策略 | 如果使用采用 ALUA 的 FC 路径，则设置为 RR （轮循）。对于所有其他配置，设置为 FIXED 。将此值设置为 RR 有助于在所有主动 / 优化路径之间实现负载平衡。固定值适用于较旧的非 ALUA 配置，有助于防止代理 I/O换言之，它有助于防止 I/O 流向在 7- 模式下运行 Data ONTAP 的环境中高可用性（ HA ）对的另一节点。 


| disk.qFullSampSize | 对于所有配置，均设置为 32 。设置此值有助于防止出现 I/O 错误。 


| disk.qFullThreshold | 对于所有配置，均设置为 8 。设置此值有助于防止出现 I/O 错误。 


| Emulex FC HBA 超时 | 使用默认值。 


| QLogic FC HBA 超时 | 使用默认值。 


| * iSCSI 设置 * |  


| 路径选择策略 | 对于所有 iSCSI 路径，设置为 RR （轮循）。将此值设置为 RR 有助于在所有主动 / 优化路径之间实现负载平衡。 


| disk.qFullSampSize | 对于所有配置，均设置为 32 。设置此值有助于防止出现 I/O 错误。 


| disk.qFullThreshold | 对于所有配置，均设置为 8 。设置此值有助于防止出现 I/O 错误。 
|===
在创建 ONTAP FlexVol 卷和 LUN 时， ONTAP 工具还会指定某些默认设置：

|===


| ONTAP 工具 | 默认设置 


| Snapshot 预留（ -percent-snapshot-space ） | 0 


| 预留百分比（ -fractional-reserve ） | 0 


| 访问时间更新（ -atime-update ） | false 


| 最小预读（ -min-readahead ） | false 


| 计划的 Snapshot 副本 | 无 


| 存储效率 | enabled 


| 卷保证 | 无（精简配置） 


| 卷自动调整大小 | grow_shrink 


| LUN 空间预留 | 已禁用 


| LUN 空间分配 | enabled 
|===


== 其他主机多路径配置注意事项

虽然目前未使用可用的 ONTAP 工具进行配置，但 NetApp 建议考虑以下配置选项：

* 在高性能环境中或使用单个 LUN 数据存储库测试性能时，请考虑将轮循（ VMW_PSP_RR ）路径选择策略（ PSP ）的负载平衡设置从默认 IOPS 设置 1000 更改为 1 。请参见 VMware 知识库 https://kb.vmware.com/s/article/2069356["2069356"^] 了解更多信息。
* 在 vSphere 6.7 Update 1 中， VMware 为轮循 PSP 引入了一种新的延迟负载平衡机制。新选项会在选择最佳 I/O 路径时考虑 I/O 带宽和路径延迟如果在具有非等效路径连接的环境中使用该工具，则可能会受益，例如，一条路径上的网络跃点多于另一条路径，或者使用 NetApp 全 SAN 阵列系统时。请参见 https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.storage.doc/GUID-B7AD0CA0-CBE2-4DB4-A22C-AD323226A257.html?hWord=N4IghgNiBcIA4Gc4AIJgC4FMB2BjAniAL5A["路径选择插件和策略"^] 有关详细信息 ...

