---
sidebar: sidebar 
permalink: virtualization/vsphere_ontap_recommended_esxi_host_and_other_ontap_settings.html 
keywords:  
summary:  
---
= 建议的 ESXi 主机和其他 ONTAP 设置
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
NetApp 已根据 NetApp 测试开发出一组 ESXi 主机多路径和 HBA 超时设置，用于正确处理 ONTAP 。可以使用适用于 VMware vSphere 的 ONTAP 工具轻松设置这些设置。在摘要信息板中，单击主机系统 portlet 中的编辑设置，或者右键单击 vCenter 中的主机，然后导航到 ONTAP tools > Set recommended values 。下面是当前在 9.8 版中建议的主机设置。

|===


| *主机设置* | * NetApp建议值* | *需要重新启动* 


3+| * ESXi高级配置* 


| VMFS3.HardwareAcceleratedLocking | 保持设置不变(VMware默认值为1) | 否 


| VMFS3.EnableBlockDelete | 保留为设置值（ VMware 默认值为 0 ，但 VMFS6 不需要此设置）。有关详细信息，请参见 link:https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2007427["VMware知识库2007427"] | 否 


3+| * NFS 设置 * 


| Net.TcpipHeapSize | vSphere 6.0 或更高版本，设置为 32 。所有其他NFS配置、设置为30 | 是的。 


| Net.TcpipHeapMax | 对于大多数vSphere 6.X版本、设置为512 MB。对于6.5U3、6.7U3和7.0或更高版本、设置为1024 MB。 | 是的。 


| NFS.MaxVolumes | vSphere 6.0或更高版本、设置为256所有其他NFS配置、设置为64。 | 否 


| NFS41.MaxVolumes | vSphere 6.0 或更高版本，设置为 256 。 | 否 


| NFS.MaxQueueDepth^1^ | vSphere 6.0或更高版本、设置为128 | 是的。 


| nfs.HeartbeatMaxFailures | 对于所有NFS配置、均设置为10 | 否 


| nfs.Heartbeat频率 | 对于所有NFS配置、均设置为12 | 否 


| nfs.HeartbeatTimeout | 对于所有 NFS 配置，均设置为 5 。 | 否 


| SUNRPC.MaxConnPerIP | vSphere 7.0 或更高版本，设置为 128 。 | 否 


3+| * FC/FCoE 设置 * 


| 路径选择策略 | 如果使用采用 ALUA 的 FC 路径，则设置为 RR （轮循）。对于所有其他配置，设置为 FIXED 。将此值设置为 RR 有助于在所有主动 / 优化路径之间实现负载平衡。固定值适用于较旧的非 ALUA 配置，有助于防止代理 I/O换言之、它有助于防止I/O流向在7-模式下运行Data ONTAP 的环境中高可用性(HA)对的另一节点 | 否 


| disk.qFullSampSize | 对于所有配置，均设置为 32 。设置此值有助于防止出现 I/O 错误。 | 否 


| disk.qFullThreshold | 对于所有配置，均设置为 8 。设置此值有助于防止出现 I/O 错误。 | 否 


| Emulex FC HBA 超时 | 使用默认值。 | 否 


| QLogic FC HBA 超时 | 使用默认值。 | 否 


3+| * iSCSI 设置 * 


| 路径选择策略 | 对于所有 iSCSI 路径，设置为 RR （轮循）。将此值设置为 RR 有助于在所有主动 / 优化路径之间实现负载平衡。 | 否 


| disk.qFullSampSize | 对于所有配置，均设置为 32 。设置此值有助于防止出现I/O错误 | 否 


| disk.qFullThreshold | 对于所有配置，均设置为 8 。设置此值有助于防止出现 I/O 错误。 | 否 
|===

NOTE: 1—使用VMware vSphere ESXi 7.0.1和VMware vSphere ESXi 7.0.2时、NFS高级配置选项MaxQueueDepth可能无法按预期工作。请参考 link:https://kb.vmware.com/s/article/86331?lang=en_US["VMware知识库86331"] 有关详细信息 ...

在创建 ONTAP FlexVol 卷和 LUN 时， ONTAP 工具还会指定某些默认设置：

|===


| * ONTAP Tool* | *默认设置* 


| Snapshot 预留（ -percent-snapshot-space ） | 0 


| 预留百分比（ -fractional-reserve ） | 0 


| 访问时间更新（ -atime-update ） | false 


| 最小预读（ -min-readahead ） | false 


| 计划的 Snapshot 副本 | 无 


| 存储效率 | enabled 


| 卷保证 | 无（精简配置） 


| 卷自动调整大小 | grow_shrink 


| LUN 空间预留 | 已禁用 


| LUN 空间分配 | enabled 
|===


== 其他主机多路径配置注意事项

虽然目前未使用可用的 ONTAP 工具进行配置，但 NetApp 建议考虑以下配置选项：

* 在高性能环境中或使用单个 LUN 数据存储库测试性能时，请考虑将轮循（ VMW_PSP_RR ）路径选择策略（ PSP ）的负载平衡设置从默认 IOPS 设置 1000 更改为 1 。请参见 VMware 知识库 https://["2069356"^] 了解更多信息。
* 在 vSphere 6.7 Update 1 中， VMware 为轮循 PSP 引入了一种新的延迟负载平衡机制。新选项会在选择最佳 I/O 路径时考虑 I/O 带宽和路径延迟如果在具有非等效路径连接的环境中使用该工具，则可能会受益，例如，一条路径上的网络跃点多于另一条路径，或者使用 NetApp 全 SAN 阵列系统时。请参见 https://["路径选择插件和策略"^] 有关详细信息 ...

