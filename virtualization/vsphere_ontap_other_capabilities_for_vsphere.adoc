---
sidebar: sidebar 
permalink: virtualization/vsphere_ontap_other_capabilities_for_vsphere.html 
keywords: Data protection, Space reclamation, VM and datastore cloning, Storage efficiency, thin provisioning, QoS, SIOC, Storage Distributed Resource Scheduler, DRS, Active IQ Unified Manager, Encryption 
summary: 使用 SnapCenter ，您可以创建可应用于多个作业的备份策略。这些策略可以定义计划，保留，复制和其他功能。它们仍允许选择虚拟机一致的快照，从而利用虚拟机管理程序在创建 VMware 快照之前暂停 I/O 的功能。 
---
= 适用于 vSphere 的其他功能
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/




== 数据保护

备份虚拟机并快速恢复虚拟机是 ONTAP for vSphere 的一项强大优势，使用适用于 VMware vSphere 的 SnapCenter 插件在 vCenter 中轻松管理此功能。使用 Snapshot 副本在不影响性能的情况下快速创建虚拟机或数据存储库的副本，然后使用 SnapMirror 将其发送到二级系统以实现长期异地数据保护。这种方法只存储更改后的信息，从而最大限度地减少存储空间和网络带宽。

使用 SnapCenter ，您可以创建可应用于多个作业的备份策略。这些策略可以定义计划，保留，复制和其他功能。它们仍允许选择虚拟机一致的快照，从而利用虚拟机管理程序在创建 VMware 快照之前暂停 I/O 的功能。但是，由于 VMware 快照对性能的影响，通常不建议使用这些快照，除非您需要暂停子文件系统。而是使用 ONTAP Snapshot 副本进行一般保护，并使用 SnapCenter 插件等应用程序工具来保护 SQL Server 或 Oracle 等事务数据。这些 Snapshot 副本与 VMware （一致性）快照不同，适用于长期保护。VMware 快照仅为 http://["建议"^] 因性能和其他影响而短期使用。

这些插件提供了扩展功能，可在物理和虚拟环境中保护数据库。借助 vSphere ，您可以使用它们来保护 SQL Server 或 Oracle 数据库，其中的数据存储在 RDM LUN 上，直接连接到子操作系统的 iSCSI LUN 或 VMFS 或 NFS 数据存储库上的 VMDK 文件上。通过这些插件，可以指定不同类型的数据库备份，支持联机或脱机备份，以及保护数据库文件和日志文件。除了备份和恢复之外，这些插件还支持出于开发或测试目的克隆数据库。

下图显示了 SnapCenter 部署的一个示例。

image:vsphere_ontap_image4.png["错误：缺少图形映像"]

要增强灾难恢复功能，请考虑将适用于 ONTAP 的 NetApp SRA 与 VMware Site Recovery Manager 结合使用。除了支持将数据存储库复制到灾难恢复站点之外，它还可以通过克隆复制的数据存储库在灾难恢复环境中进行无中断测试。通过 SRA 中内置的自动化功能，还可以轻松地从灾难中恢复并在中断解决后重新保护生产。

最后，要获得最高级别的数据保护，请考虑使用 NetApp MetroCluster 的 VMware vSphere 城域存储集群（ VMSC ）配置。VMSC 是一款经过 VMware 认证的解决方案，它将同步复制与基于阵列的集群相结合，可提供与高可用性集群相同的优势，但分布在不同的站点上以防止站点灾难。NetApp MetroCluster 可为同步复制提供经济高效的配置，可从任何单个存储组件故障中透明恢复，并在发生站点灾难时提供单命令恢复。中详细介绍了 VMSC http://["TR-4128"^]。



== 空间回收

从数据存储库中删除 VM 时，可以回收空间以用于其他用途。使用 NFS 数据存储库时，删除虚拟机时会立即回收空间（当然，只有在卷已进行精简配置时，即卷保证设置为 none ），此方法才有意义。但是，在 VM 子操作系统中删除文件时，不会使用 NFS 数据存储库自动回收空间。对于基于 LUN 的 VMFS 数据存储库， ESXi 以及子操作系统可以将 VAAI UNMAP 原语问题描述到存储（同样适用于使用精简配置时）以回收空间。根据版本的不同，此支持可以是手动支持，也可以是自动支持。

在 vSphere 5.5 及更高版本中， `vmkfstools – y` 命令将替换为 `esxcli storage vmfs unmap` 命令，该命令可指定可用块的数量（请参见 VMware 知识库 https://["2057513"^] 了解更多信息）。在 vSphere 6.5 及更高版本中，如果使用 VMFS 6 ，则应异步自动回收空间（请参见 https://["存储空间回收"^] 在 vSphere 文档中），但也可以根据需要手动运行。ONTAP 支持这种自动 UNMAP ，适用于 VMware vSphere 的 ONTAP 工具会将其设置为低优先级。请注意、在配置LUN以用作VMFS数据存储库时、必须手动在LUN上启用空间分配选项。在使用适用于VMware vSphere的ONTAP 工具时、LUN会自动配置为支持空间回收、无需执行其他操作。请参见 https://["这"^] 有关更多详细信息、请参见知识库文章。



== 虚拟机和数据存储库克隆

通过克隆存储对象，您可以快速创建副本以供将来使用，例如配置其他 VM ，备份 / 恢复操作等。在 vSphere 中，您可以克隆虚拟机，虚拟磁盘， VVol 或数据存储库。克隆后，通常可以通过自动化过程进一步自定义对象。vSphere 既支持完整副本克隆，也支持链接克隆，在这些克隆中，它可以独立于原始对象跟踪更改。

链接克隆非常有助于节省空间，但它们会增加 vSphere 为虚拟机处理的 I/O 量，从而影响该虚拟机的性能，甚至整个主机的性能。这就是 NetApp 客户经常使用基于存储系统的克隆来充分利用这两种环境的原因：高效利用存储和提高性能。

下图显示了 ONTAP 克隆。

image:vsphere_ontap_image5.png["错误：缺少图形映像"]

可以通过多种机制将克隆卸载到运行 ONTAP 软件的系统，通常是在 VM ， VVOL 或数据存储库级别。其中包括：

* 使用 NetApp vSphere APIs for Storage Awareness （ VASA ） Provider 的 VVOL 。ONTAP 克隆用于支持由 vCenter 管理的 VVOL Snapshot 副本，这些副本节省空间，并且对创建和删除这些副本的 I/O 影响微乎其微。此外，还可以使用 vCenter 克隆 VM ，这些 VM 也会卸载到 ONTAP ，无论是在单个数据存储库 / 卷中还是在数据存储库 / 卷之间。
* 使用 vSphere API —阵列集成（ VAAI ）进行 vSphere 克隆和迁移。在 SAN 和 NAS 环境中， VM 克隆操作均可卸载到 ONTAP （ NetApp 提供了一个 ESXi 插件，用于为 NFS 启用 VAAI ）。vSphere 仅会卸载 NAS 数据存储库中冷（已关闭） VM 上的操作，而热 VM （克隆和存储 vMotion ）上的操作也会卸载到 SAN 上。ONTAP 会根据源，目标和已安装的产品许可证使用最高效的方法。VMware Horizon View 也使用此功能。
* SRA （与 VMware Site Recovery Manager 结合使用）。此处，克隆用于无中断测试灾难恢复副本的恢复情况。
* 使用 SnapCenter 等 NetApp 工具进行备份和恢复。VM 克隆用于验证备份操作以及挂载 VM 备份，以便可以复制单个文件。


VMware ， NetApp 和第三方工具可以调用 ONTAP 卸载克隆。卸载到 ONTAP 的克隆具有多个优势。在大多数情况下，它们节省空间，只需要存储即可更改对象；读取和写入它们不会产生额外的性能影响，在某些情况下，通过在高速缓存中共享块来提高性能。它们还会从 ESXi 服务器卸载 CPU 周期和网络 I/O 。使用 FlexVol 卷在使用 FlexClone 的传统数据存储库中进行副本卸载速度快，效率高，但 FlexVol 卷之间的副本卸载速度可能较慢。如果您将 VM 模板维护为克隆源，请考虑将其放置在数据存储库卷中（使用文件夹或内容库对其进行组织），以实现节省空间的快速克隆。

您也可以直接在 ONTAP 中克隆卷或 LUN 以克隆数据存储库。使用 NFS 数据存储库时， FlexClone 技术可以克隆整个卷，并且可以从 ONTAP 导出克隆并由 ESXi 作为另一个数据存储库挂载该克隆。对于 VMFS 数据存储库， ONTAP 可以克隆卷或整个卷中的 LUN ，包括其中的一个或多个 LUN 。包含 VMFS 的 LUN 必须映射到 ESXi 启动程序组（ igroup ），然后由 ESXi 重新签名，才能挂载并用作常规数据存储库。对于某些临时使用情形，可以挂载克隆的 VMFS 而无需重新签名。克隆数据存储库后，可以注册，重新配置和自定义数据存储库中的 VM ，就像它们是单独克隆的 VM 一样。

在某些情况下，可以使用其他许可功能来增强克隆功能，例如用于备份的 SnapRestore 或 FlexClone 。这些许可证通常包含在许可证包中，无需额外付费。要执行 VVOL 克隆操作以及支持 VVOL 的受管 Snapshot 副本（这些副本会从虚拟机管理程序卸载到 ONTAP ），需要 FlexClone 许可证。在数据存储库 / 卷中使用 FlexClone 许可证还可以改进某些基于 VAAI 的克隆（创建节省空间的即时副本，而不是块副本）。此外， SRA 还会使用它来测试灾难恢复副本的恢复，并使用 SnapCenter 来执行克隆操作，以及浏览备份副本以还原单个文件。



== 存储效率和精简配置

NetApp 凭借存储效率创新技术引领行业发展，例如首款针对主工作负载的重复数据删除技术以及实时数据缩减技术，这些技术可增强数据压缩能力并高效存储小文件和 I/O 。ONTAP 支持实时和后台重复数据删除，以及实时和后台数据压缩。

下图展示了 ONTAP 存储效率功能的综合影响。

image:vsphere_ontap_image6.jpeg["错误：缺少图形映像"]

以下是在 vSphere 环境中使用 ONTAP 存储效率的建议：

* 重复数据删除节省的数据量取决于数据的共性。对于 ONTAP 9.1 及更早版本，重复数据删除在卷级别运行，而对于 ONTAP 9.2 及更高版本中的聚合重复数据删除，则在 AFF 系统上的聚合中的所有卷之间对数据进行重复数据删除。您无需再将类似的操作系统和类似应用程序分组到一个数据存储库中，即可最大程度地节省空间。
* 要在块环境中实现重复数据删除的优势，必须对 LUN 进行精简配置。尽管 VM 管理员仍认为 LUN 占用了已配置的容量，但重复数据删除节省的空间会返回到卷中以用于其他需求。NetApp 建议在同样经过精简配置的 FlexVol 卷中部署这些 LUN （适用于 VMware vSphere 的 ONTAP 工具会将卷大小比 LUN 大 5% 左右）。
* 此外，还建议对 NFS FlexVol 卷进行精简配置（这是默认设置）。在 NFS 环境中，使用精简配置卷的存储和 VM 管理员可以立即看到重复数据删除节省的空间。
* 也可以对 VM 进行精简配置适用场景， NetApp 通常建议使用精简配置的 VMDK ，而不是厚 VMDK 。使用精简配置时，请确保使用适用于 VMware vSphere ， ONTAP 的 ONTAP 工具或其他可用工具监控可用空间，以避免出现空间不足问题。
* 请注意，在 ONTAP 系统中使用精简配置时不会影响性能；数据会写入可用空间，以便最大程度地提高写入性能和读取性能。尽管如此， Microsoft 故障转移集群或其他低延迟应用程序等某些产品可能需要有保障或固定的配置，因此最好遵循这些要求来避免出现支持问题。
* 要最大程度地节省重复数据删除的空间，请考虑在基于硬盘的系统上计划后台重复数据删除，或者在 AFF 系统上计划自动后台重复数据删除。但是，计划的进程在运行时会使用系统资源，因此，理想情况下，应将其计划在活动较少的时间（例如周末）或更频繁地运行，以减少要处理的更改后的数据量。AFF 系统上的自动后台重复数据删除对前台活动的影响要小得多。后台数据压缩（对于基于硬盘的系统）也会占用资源，因此，只能考虑对性能要求有限的二级工作负载进行数据压缩。
* NetApp AFF 系统主要使用实时存储效率功能。使用 7- 模式过渡工具， SnapMirror 或卷移动等使用块复制的 NetApp 工具将数据移动到其中时，运行数据压缩和数据缩减扫描程序可以最大程度地节省效率。查看此 NetApp 支持 https://["知识库文章"^] 了解更多详细信息。
* Snapshot 副本可能会锁定可通过数据压缩或重复数据删除来减少的块。使用计划的后台效率扫描程序或一次性扫描程序时，请确保在创建下一个 Snapshot 副本之前运行并完成这些扫描程序。检查 Snapshot 副本和保留情况，确保仅保留所需的 Snapshot 副本，尤其是在运行后台或扫描程序作业之前。


下表为不同类型的 ONTAP 存储上的虚拟化工作负载提供了存储效率准则：

[cols="10,30,30,30"]
|===
| 工作负载 3+| 存储效率准则 


|  | AFF | Flash Pool | 硬盘驱动器 


| VDI 和 SVI  a| 
对于主工作负载和二级工作负载，请使用：

* 自适应实时压缩
* 实时重复数据删除
* 后台重复数据删除
* 实时数据缩减

 a| 
对于主工作负载和二级工作负载，请使用：

* 自适应实时压缩
* 实时重复数据删除
* 后台重复数据删除
* 实时数据缩减

 a| 
对于主工作负载，请使用：

* 后台重复数据删除


对于二级工作负载，请使用：

* 自适应实时压缩
* 自适应后台数据压缩
* 实时重复数据删除
* 后台重复数据删除
* 实时数据缩减


|===


== 服务质量（ QoS ）

运行 ONTAP 软件的系统可以使用 ONTAP 存储服务质量功能来限制文件， LUN ，卷或整个 SVM 等不同存储对象的吞吐量（以 MBps 和 / 或每秒 I/O 数（ IOPS ）为单位）。

吞吐量限制可用于在部署前控制未知工作负载或测试工作负载，以确保它们不会影响其他工作负载。它们还可用于在确定抢占资源的工作负载后对其进行限制。此外，还支持基于 IOPS 的最低服务级别，以便为 ONTAP 9.2 中的 SAN 对象和 ONTAP 9.3 中的 NAS 对象提供稳定一致的性能。

对于 NFS 数据存储库，可以将 QoS 策略应用于整个 FlexVol 卷或其中的单个 VMDK 文件。对于使用 ONTAP LUN 的 VMFS 数据存储库，可以将 QoS 策略应用于包含 LUN 或单个 LUN 的 FlexVol 卷，但不能应用于单个 VMDK 文件，因为 ONTAP 无法识别 VMFS 文件系统。使用 VVOL 时，可以使用存储功能配置文件和 VM 存储策略在各个 VM 上设置最小和 / 或最大 QoS 。

可以使用 MBps 和 / 或 IOPS 设置对象的 QoS 最大吞吐量限制。如果同时使用这两者，则 ONTAP 会强制实施达到的第一个限制。一个工作负载可以包含多个对象，一个 QoS 策略可以应用于一个或多个工作负载。将一个策略应用于多个工作负载时，这些工作负载将共享此策略的总限制。不支持嵌套对象（例如，卷中的文件不能各自具有自己的策略）。QoS 最小值只能以 IOPS 为单位进行设置。

目前，以下工具可用于管理 ONTAP QoS 策略并将其应用于对象：

* ONTAP 命令行界面
* ONTAP 系统管理器
* OnCommand Workflow Automation
* Active IQ Unified Manager
* 适用于 ONTAP 的 NetApp PowerShell 工具包
* 适用于 VMware vSphere VASA Provider 的 ONTAP 工具


要将 QoS 策略分配给 NFS 上的 VMDK ，请注意以下准则：

* 必须将此策略应用于包含实际虚拟磁盘映像的 `vmname- flat.vmdk` ，而不是 `vmname.vmdk` （虚拟磁盘描述符文件）或 `vmname.vmx` （ VM 描述符文件）。
* 请勿将策略应用于其他 VM 文件，例如虚拟交换文件（`vmname.vswp` ）。
* 使用 vSphere Web Client 查找文件路径（数据存储库 > 文件）时，请注意，它会将 ` flat.vmdk` 和 ` 的信息结合在一起。vmdk` 和仅显示一个名为 ` 的文件。vmdk` 但 ` 的大小为 flat.vmdk` 。将 ` -flat` 添加到文件名中以获取正确的路径。


要为 LUN （包括 VMFS 和 RDM ）分配 QoS 策略，可以从适用于 VMware vSphere 的 ONTAP 工具主页上的存储系统菜单获取 ONTAP SVM （显示为 Vserver ）， LUN 路径和序列号。选择存储系统（ SVM ），然后选择相关对象 > SAN 。使用 ONTAP 工具之一指定 QoS 时，请使用此方法。

使用适用于 VMware vSphere 的 ONTAP 工具或 Virtual Storage Console 7.1 及更高版本，可以轻松地为基于 VVOL 的虚拟机分配最大和最小 QoS 。在为 VVol 容器创建存储功能配置文件时，请在性能功能下指定最大和 / 或最小 IOPS 值，然后将此 SCP 与虚拟机的存储策略联系起来。在创建虚拟机时使用此策略或将此策略应用于现有虚拟机。

在使用适用于 VMware vSphere 9.8 及更高版本的 ONTAP 工具时， FlexGroup 数据存储库可提供增强的 QoS 功能。您可以轻松地在数据存储库中的所有 VM 或特定 VM 上设置 QoS 。有关详细信息，请参见本报告的 FlexGroup 一节。



=== ONTAP QoS 和 VMware SIOC

ONTAP QoS 和 VMware vSphere 存储 I/O 控制（ SIOC ）是 vSphere 和存储管理员可以结合使用的补充技术，用于管理运行 ONTAP 软件的系统上托管的 vSphere VM 的性能。每个工具都有自己的优势，如下表所示。由于 VMware vCenter 和 ONTAP 的作用域不同，因此某些对象可以由一个系统查看和管理，而不能由另一个系统查看和管理。

|===
| 属性 | ONTAP QoS | VMware SIOC 


| 处于活动状态时 | 策略始终处于活动状态 | 存在争用时处于活动状态（数据存储库延迟超过阈值） 


| 单位类型 | IOPS ， MBps | IOPS ，共享 


| vCenter 或应用程序范围 | 多个 vCenter 环境，其他虚拟机管理程序和应用程序 | 单个 vCenter 服务器 


| 是否在虚拟机上设置 QoS ？ | 仅限 NFS 上的 VMDK | NFS 或 VMFS 上的 VMDK 


| 是否为 LUN 设置 QoS （ RDM ）？ | 是的。 | 否 


| 是否为 LUN （ VMFS ）设置 QoS ？ | 是的。 | 否 


| 是否为卷（ NFS 数据存储库）设置 QoS ？ | 是的。 | 否 


| 是否在 SVM （租户）上设置 QoS ？ | 是的。 | 否 


| 基于策略的方法？ | 是；可以由策略中的所有工作负载共享，也可以将其全部应用于策略中的每个工作负载。 | 是，在 vSphere 6.5 及更高版本中。 


| 需要许可证 | 随 ONTAP 提供 | Enterprise Plus 
|===


== VMware Storage Distributed Resource Scheduler

VMware Storage Distributed Resource Scheduler （ SDRS ）是一项 vSphere 功能，可根据当前 I/O 延迟和空间使用情况将 VM 放置在存储上。然后，它会在数据存储库集群（也称为 Pod ）中的数据存储库之间无中断地移动虚拟机或 VMDK ，从而选择最佳数据存储库，以便将虚拟机或 VMDK 放置在数据存储库集群中。数据存储库集群是一组类似的数据存储库，从 vSphere 管理员的角度来看，这些数据存储库会聚合为一个使用单位。

在将 SDRS 与适用于 VMware vSphere 的 NetApp ONTAP 工具结合使用时，您必须先使用此插件创建数据存储库，使用 vCenter 创建数据存储库集群，然后将此数据存储库添加到其中。创建数据存储库集群后，可以直接从详细信息页面上的配置向导将其他数据存储库添加到数据存储库集群中。

有关 SDRS 的其他 ONTAP 最佳实践包括：

* 集群中的所有数据存储库都应使用相同类型的存储（例如 SAS ， SATA 或 SSD ），可以是所有 VMFS 或 NFS 数据存储库，并且具有相同的复制和保护设置。
* 请考虑在默认（手动）模式下使用 SDRS 。通过此方法，您可以查看建议并决定是否应用这些建议。请注意 VMDK 迁移的以下影响：
+
** 在数据存储库之间移动 VMDK 时，通过 ONTAP 克隆或重复数据删除节省的任何空间都将丢失。您可以重新运行重复数据删除以重新获得这些节省。
** SDRS 移动 VMDK 后， NetApp 建议在源数据存储库中重新创建 Snapshot 副本，因为空间会被移动的虚拟机锁定。
** 在同一聚合上的数据存储库之间移动 VMDK 没有什么优势， SDRS 无法查看可能共享该聚合的其他工作负载。






=== 基于存储策略的管理和 VVOL

通过 VMware vSphere 存储感知 API （ VASA ），存储管理员可以轻松地为数据存储库配置定义明确的功能，并允许 VM 管理员在需要时使用这些功能来配置 VM ，而无需彼此交互。值得一看的是，这种方法可以帮助您简化虚拟化存储操作并避免大量琐碎的工作。

在使用 VASA 之前， VM 管理员可以定义 VM 存储策略，但他们必须与存储管理员合作，通常使用文档或命名约定来确定适当的数据存储库。借助 VASA ，存储管理员可以定义一系列存储功能，包括性能，分层，加密和复制。一个卷或一组卷的一组功能称为存储功能配置文件（ Storage Capability Profile ， SCP ）。

SCP 支持对 VM 的数据 VVol 执行最小和 / 或最大 QoS 。只有 AFF 系统才支持最低 QoS 。适用于 VMware vSphere 的 ONTAP 工具包含一个信息板，用于显示 ONTAP 系统上 VVol 的 VM 粒度性能和逻辑容量。

下图显示了适用于 VMware vSphere 9.8 VVol 的 ONTAP 工具信息板。

image:vsphere_ontap_image7.png["错误：缺少图形映像"]

定义存储功能配置文件后，可以使用该配置文件来使用存储策略来配置 VM ，以确定其要求。通过 VM 存储策略与数据存储库存储功能配置文件之间的映射， vCenter 可以显示一个兼容数据存储库列表以供选择。这种方法称为基于存储策略的管理。

VASA 提供了查询存储并将一组存储功能返回到 vCenter 的技术。VASA 供应商提供程序可在存储系统 API 和构造与 vCenter 可识别的 VMware API 之间进行转换。NetApp 的适用于 ONTAP 的 VASA Provider 是作为适用于 VMware vSphere 设备 VM 的 ONTAP 工具的一部分提供的， vCenter 插件提供了用于配置和管理 VVOL 数据存储库的界面，并能够定义存储功能配置文件（ SCP ）。

ONTAP 同时支持 VMFS 和 NFS VVol 数据存储库。将 VVOL 与 SAN 数据存储库结合使用可带来 NFS 的一些优势，例如虚拟机级别粒度。下面是一些需要考虑的最佳实践，您可以在中找到追加信息 http://["TR-4400"^]：

* 一个 VVOL 数据存储库可以在多个集群节点上包含多个 FlexVol 卷。最简单的方法是使用一个数据存储库，即使卷具有不同的功能也是如此。SPBM 可确保为 VM 使用兼容的卷。但是，这些卷都必须属于一个 ONTAP SVM ，并使用一个协议进行访问。对于每个协议，每个节点一个 LIF 就足够了。避免在一个 VVOL 数据存储库中使用多个 ONTAP 版本，因为存储功能可能因版本而异。
* 使用适用于 VMware vSphere 的 ONTAP 工具插件创建和管理 VVOL 数据存储库。除了管理数据存储库及其配置文件之外，它还会根据需要自动创建一个协议端点来访问 VVol 。如果使用 LUN ，请注意， LUN PE 会使用 LUN ID 300 及更高版本进行映射。验证 ESXi 主机高级系统设置 `Disk.MaxLUN` 是否允许使用 300 以上的 LUN ID 编号（默认值为 1 ， 024 ）。执行此步骤的方法是，在 vCenter 中选择 ESXi 主机，然后选择配置选项卡，并在高级系统设置列表中找到 `Disk.MaxLUN` 。
* 请勿将适用于 VMware vSphere 的 VASA Provider ， vCenter Server （设备或基于 Windows ）或 ONTAP 工具本身安装或迁移到 VVOL 数据存储库中，因为它们相互依赖，因此会限制您在发生断电或其他数据中心中断时对其进行管理的能力。
* 定期备份 VASA Provider 虚拟机。至少为包含 VASA Provider 的传统数据存储库创建每小时 Snapshot 副本。有关保护和恢复 VASA Provider 的详细信息，请参见此部分 https://["知识库文章"^]。


下图显示了 VVOL 组件。

image:vsphere_ontap_image8.png["错误：缺少图形映像"]



== 云迁移和备份

ONTAP 的另一个优势是广泛支持混合云，将内部私有云中的系统与公有云功能相结合。以下是可与 vSphere 结合使用的一些 NetApp 云解决方案：

* * 云卷。 * NetApp Cloud Volumes Service for AWS 或 GCP 以及 Azure NetApp Files for ANF 可在领先的公有云环境中提供高性能，多协议托管存储服务。它们可以直接由 VMware Cloud VM 子系统使用。
* * Cloud Volumes ONTAP 。 * NetApp Cloud Volumes ONTAP 数据管理软件可在您选择的云中控制，保护，灵活性和效率您的数据。Cloud Volumes ONTAP 是基于 NetApp ONTAP 存储软件构建的云原生数据管理软件。与 Cloud Manager 结合使用，可与内部 ONTAP 系统一起部署和管理 Cloud Volumes ONTAP 实例。利用高级 NAS 和 iSCSI SAN 功能以及统一数据管理，包括 Snapshot 副本和 SnapMirror 复制。
* * 云服务。 * 使用 Cloud Backup Service 或 SnapMirror 云保护数据免受使用公有云存储的内部系统的影响。Cloud Sync 有助于在 NAS ，对象存储和 Cloud Volumes Service 存储之间迁移和保持数据同步。
* * FabricPool 。 * FabricPool 可为 ONTAP 数据快速轻松地分层。Snapshot 副本中的冷块可以迁移到公有云或私有 StorageGRID 对象存储中的对象存储，并在再次访问 ONTAP 数据时自动重新调用。或者，使用对象层作为已由 SnapVault 管理的数据的第三级保护。这种方法可以让您做到 https://["存储 VM 的更多 Snapshot 副本"^] 在主和 / 或二级 ONTAP 存储系统上。
* * ONTAP Select 。 * 使用 NetApp 软件定义的存储将您的私有云扩展到 Internet 上的远程设施和办公室，您可以在这些设施和办公室使用 ONTAP Select 支持块和文件服务以及您在企业数据中心拥有的相同 vSphere 数据管理功能。


在设计基于 VM 的应用程序时，请考虑未来的云移动性。例如，与其将应用程序和数据文件放在一起，不如对数据使用单独的 LUN 或 NFS 导出。这样，您就可以将虚拟机和数据单独迁移到云服务。



== vSphere 数据加密

如今，通过加密保护空闲数据的需求日益增长。虽然最初的重点是财务和医疗保健信息，但对保护所有信息的兴趣日益增加，无论这些信息存储在文件，数据库还是其他数据类型中。

运行 ONTAP 软件的系统可通过空闲加密轻松保护任何数据。NetApp 存储加密（ NetApp Storage Encryption ， NSE ）使用带有 ONTAP 的自加密磁盘驱动器来保护 SAN 和 NAS 数据。NetApp 还提供 NetApp 卷加密和 NetApp 聚合加密，这是一种基于软件的简单方法，用于对任何磁盘驱动器上的卷进行加密。此软件加密不需要特殊的磁盘驱动器或外部密钥管理器， ONTAP 客户无需额外付费即可使用。您可以在不中断客户端或应用程序的情况下升级并开始使用它，并且它们已通过 FIPS 140-2 1 级标准（包括板载密钥管理器）的验证。

可以通过多种方法保护在 VMware vSphere 上运行的虚拟化应用程序的数据。一种方法是在子操作系统级别使用虚拟机中的软件保护数据。vSphere 6.5 等较新的虚拟机管理程序现在支持在 VM 级别进行加密，这是另一种替代方案。但是， NetApp 软件加密简单易用，并且具有以下优势：

* * 对虚拟服务器 CPU 没有影响。 * 某些虚拟服务器环境需要为其应用程序提供每个可用的 CPU 周期，但测试表明，使用虚拟机管理程序级别的加密最多需要 5 倍的 CPU 资源。即使加密软件支持将 Intel 的 AES-NI 指令集用于卸载加密工作负载（就像 NetApp 软件加密一样），由于需要使用与旧版服务器不兼容的新 CPU ，此方法也可能不可行。
* * 包括板载密钥管理器。 * NetApp 软件加密包括板载密钥管理器，无需额外付费，无需购买和使用复杂的高可用性密钥管理服务器即可轻松启动。
* * 对存储效率没有影响。 * 重复数据删除和数据压缩等存储效率技术目前已广泛应用，是经济高效地使用闪存磁盘介质的关键。但是，加密数据通常无法进行重复数据删除或压缩。与其他方法不同， NetApp 硬件和存储加密的运行级别较低，并允许充分利用行业领先的 NetApp 存储效率功能。
* * 轻松的数据存储库粒度加密。 * 借助 NetApp 卷加密，每个卷都获得自己的 AES 256 位密钥。如果需要更改，只需使用一个命令即可。如果您有多个租户或需要为不同部门或应用程序证明独立加密，则此方法非常适合。此加密在数据存储库级别进行管理，比管理单个虚拟机要简单得多。


开始使用软件加密非常简单。安装许可证后，只需通过指定密码短语来配置板载密钥管理器，然后创建新卷或移动存储端卷以启用加密即可。NetApp 正在努力在其未来版本的 VMware 工具中增加对加密功能的集成支持。



== Active IQ Unified Manager

通过 Active IQ Unified Manager 可以查看虚拟基础架构中的虚拟机，并监控虚拟环境中的存储和性能问题并对其进行故障排除。

ONTAP 上的典型虚拟基础架构部署包含多个组件，这些组件分布在计算层，网络层和存储层上。VM 应用程序中的任何性能滞后都可能是由于各个层的各个组件同时面临的延迟造成的。

以下屏幕截图显示了 Active IQ Unified Manager 虚拟机视图。

image:vsphere_ontap_image9.png["错误：缺少图形映像"]

Unified Manager 以拓扑视图形式呈现虚拟环境的底层子系统，用于确定计算节点，网络或存储是否发生延迟问题描述。此视图还会突出显示导致执行补救步骤和解决底层问题描述时出现性能滞后的特定对象。

以下屏幕截图显示了 AIQUM 扩展拓扑。

image:vsphere_ontap_image10.png["错误：缺少图形映像"]
