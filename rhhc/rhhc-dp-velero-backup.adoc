---
sidebar: sidebar 
permalink: rhhc/rhhc-dp-velero-backup.html 
keywords: OpenShift, OCP, Astra Trident, NetApp ONTAP, Red Hat OpenShift, OADP operator, Openshift Data Protection Application operator, Velero 
summary: 使用NetApp ONTAP实现Red Hat OpenShift容器应用程序数据保护 
---
= 在OpenShift容器平台中为应用程序创建按需备份
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
本节概述如何在OpenShift虚拟化中为VM创建按需备份。



== 创建应用程序备份的步骤

要创建应用程序的按需备份(应用程序元数据和应用程序的永久性卷)、请单击**备份**选项卡以创建备份自定义资源(CR)。提供了一个示例YAML以创建备份CR。使用此YAML、将备份指定命名空间中的应用及其永久性存储。其它参数可按中所示进行设置 link:https://docs.openshift.com/container-platform/4.14/backup_and_restore/application_backup_and_restore/backing_up_and_restoring/oadp-creating-backup-cr.html["文档。"]。

CSI将创建指定命名空间中永久性卷和应用程序资源的快照。此快照将存储在YAML中指定的备份位置。备份将在系统中保留30天、如TTL中所指定。

....
spec:
  csiSnapshotTimeout: 10m0s
  defaultVolumesToFsBackup: false
  includedNamespaces:
    - postgresql ->namespace of the app
  itemOperationTimeout: 4h0m0s
  snapshotMoveData: false
  storageLocation: velero-container-backup-ontap-1 -->this is the backupStorageLocation previously created when Velero is configured.
  ttl: 720h0m0s
....
备份完成后、其阶段将显示为已完成。

image::redhat_openshift_OADP_backup_image1.png[备份已完成]

您可以借助S3浏览器应用程序检查对象存储中的备份。备份路径显示在已配置的分段中、前缀名称为(velero/container-demo-backup)。您可以查看备份内容、包括卷快照、日志和应用程序的其他元数据。


NOTE: 在StorageGRID中、您还可以使用租户管理器提供的S3控制台来查看备份对象。

image::redhat_openshift_OADP_backup_image2.png[S3中的备份对象]



== 为应用程序创建计划备份

要按计划创建备份、您需要创建计划CR。该计划只是一个cron表达式、允许您指定创建备份的时间。下面显示了创建计划CR的YAML示例。

....
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: schedule1
  namespace: openshift-adp
spec:
  schedule: 0 7 * * *
  template:
    includedNamespaces:
      - postgresql
    storageLocation: velero-container-backup-ontap-1
....
cron表达式07 ***表示每天7：00创建备份。
此外、还会指定要包含在备份中的空间以及备份的存储位置。因此、使用计划CR而不是备份CR来按指定的时间和频率创建备份。

创建计划后、该计划将处于启用状态。

image::redhat_openshift_OADP_backup_image3.png[已创建计划]

备份将按照此计划创建、并可从备份选项卡查看。

image::redhat_openshift_OADP_backup_image4.png[已完成计划备份]
