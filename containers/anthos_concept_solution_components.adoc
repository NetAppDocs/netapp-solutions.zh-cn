---
sidebar: sidebar 
permalink: containers/anthos_concept_solution_components.html 
summary: 本文档中介绍的解决方案基于 NetApp HCI ， VMware vSphere 和 Anthos 混合云 Kubernetes 数据中心解决方案的坚实基础。 
keywords: ESXi, Vmware, vSphere, Element 
---
= 解决方案组件


本文档中介绍的解决方案基于 NetApp HCI ， VMware vSphere 和 Anthos 混合云 Kubernetes 数据中心解决方案的坚实基础。



== NetApp HCI

通过提供灵活的统包基础架构平台， NetApp HCI 可以帮助您加快运行企业级虚拟化和容器化工作负载的速度。NetApp HCI 的核心设计旨在提供可预测的性能，计算和存储资源的线性可扩展性以及简单的部署和管理体验。

* * 可预测。 * 在多租户环境中，最大的挑战之一是为所有工作负载提供一致，可预测的性能。运行多个企业级工作负载可能会导致资源争用，其中一个工作负载可能会影响另一个工作负载的性能。NetApp HCI 通过 NetApp Element 软件本机提供的存储服务质量（ QoS ）限制缓解了这一顾虑。Element 支持精细控制每个应用程序和卷，有助于消除资源争用问题，并满足企业性能 SLA 的要求。NetApp HCI 多租户功能有助于消除许多传统的性能相关问题。
* * 灵活。 * 前几代超融合基础架构通常需要固定的资源比率，将部署限制为四节点和八节点配置。NetApp HCI 是一种可独立扩展计算和存储资源的分解式超融合基础架构。独立扩展可防止成本高昂且效率低下的过度配置，消除控制器 VM 开销中 10% 到 30% 的 HCI 费用，并简化容量和性能规划。NetApp HCI 提供混合搭配的小型，中型和大型存储和计算配置。通过提供的架构设计选项，您可以自信地根据自己的需求进行扩展，从而使 HCI 适用于核心的第 1 层数据中心应用程序和平台。NetApp HCI 采用机箱或节点级别的组件设计。在由存储或计算节点组成的混合配置中，每个机箱可以容纳四个节点。
* * 简单。 * IT 社区中的一项驱动任务是简化部署并自动执行日常任务，消除用户出错的风险，同时腾出资源专注于更有趣，价值更高的项目。NetApp HCI 可以通过简化部署和持续管理来帮助您的 IT 部门提高灵活性和响应能力。NetApp 部署引擎（ NetApp Deployment Engine ， NDE ）工具可简化物理基础架构的配置和部署，包括安装 VMware vSphere 环境以及集成适用于 vCenter Server 的 NetApp Element 插件。借助 NDE ，可以轻松执行未来的扩展操作。




=== NetApp IP 配置

NetApp HCI 是一款企业级离散混合云基础架构（ HCI ）解决方案，可通过一个灵活，可扩展且易于管理的双机架单元（ 2RU ）四节点组件提供计算和存储资源。此外，还可以为其配置 1RU 计算和服务器节点。本指南中引用的 NetApp HCI 部署由四个 NetApp HCI 存储节点和两个 NetApp HCI 计算节点组成。计算节点作为 VMware ESXi 虚拟机管理程序安装在 HA 集群中，而无需强制实施 VMware DRS 反关联性规则。通过添加额外的 NetApp HCI 存储或计算节点以扩展可用存储，可以轻松扩展这种最低部署规模，以满足客户企业工作负载需求。下图显示了 NetApp HCI 的最低配置。

image::netapp_hci_min_config.png[NetApp HCI 最低配置]

NetApp HCI for Anthos 的设计在最低初始配置中包含以下组件：

* 运行 NetApp Element 软件的 NetApp H 系列全闪存存储节点
* 运行 VMware vSphere 6.7U3 的 NetApp H 系列计算节点


有关 NetApp HCI 中计算和存储节点的详细信息，请参见 https://www.netapp.com/us/media/ds-3881.pdf["NetApp HCI 产品规格"]。



==== NetApp Element 软件

NetApp Element 软件可提供模块化的可扩展性能，每个存储节点均可为环境提供有保障的容量和吞吐量。您还可以指定每个卷的存储 QoS 策略，以支持即使是要求最苛刻的工作负载也能达到专用性能级别。



===== iSCSI 登录重定向和自我修复功能

NetApp Element 软件使用 iSCSI 存储协议，这是在传统 TCP/IP 网络上封装 SCSI 命令的标准方式。当 SCSI 标准发生变化或以太网网络性能提高时， iSCSI 存储协议将受益，而无需进行任何更改。

尽管所有存储节点都有一个管理 IP 和一个存储 IP ，但 NetApp Element 软件会为集群中的所有存储流量公布一个存储虚拟 IP 地址（ SVIP 地址）。在 iSCSI 登录过程中，存储可以响应目标卷已移至其他地址，因此无法继续协商过程。然后，主机将在不需要主机端重新配置的过程中向新地址重新发出登录请求。此过程称为 iSCSI 登录重定向。

iSCSI 登录重定向是 NetApp Element 软件集群的一个关键部分。收到主机登录请求后，节点将根据 IOPS 和卷的容量要求确定集群中应由哪个成员处理流量。卷分布在 NetApp Element 软件集群中，如果单个节点处理的卷流量过多或添加了新节点，则会重新分配这些卷。给定卷的多个副本会在阵列中分配。这样，如果节点发生故障后又发生卷重新分布，则除了注销和登录并重定向到新位置之外，对主机连接不会产生任何影响。通过 iSCSI 登录重定向， NetApp Element 软件集群是一种自我修复型横向扩展架构，能够实现无中断升级和操作。



===== NetApp Element 软件集群 QoS

通过 NetApp Element 软件集群，可以按卷动态配置 QoS 。您可以使用每个卷的 QoS 设置根据定义的 SLA 控制存储性能。以下三个可配置参数用于定义 QoS ：

* * 最小 IOPS* 。 NetApp Element 软件集群为卷提供的最小可持续 IOPS 数。为卷配置的最小 IOPS 是卷的性能保证级别。每个卷的性能不会低于此级别。
* * 最大 IOPS* 。 NetApp Element 软件集群为特定卷提供的最大可持续 IOPS 数。
* * 突发 IOPS 。 * 在短时突发情形下允许的最大 IOPS 数。突发持续时间设置是可配置的，默认值为 1 分钟。如果卷运行的 IOPS 低于最大 IOPS 级别，则会累积突发额度。如果性能级别变得非常高并不断推送，则允许卷上的 IOPS 短时突发超过最大 IOPS 。




===== 多租户

可通过以下功能实现安全多租户：

* * 安全身份验证。 * 质询握手身份验证协议（ Challenge-Handshake Authentication Protocol ， CHAP ）用于安全卷访问。轻量级目录访问协议（ Lightweight Directory Access Protocol ， LDAP ）用于安全访问集群以进行管理和报告。
* * 卷访问组（ VAG ）。 * 也可以使用 VAG 代替身份验证，将任意数量的 iSCSI 启动程序专用 iSCSI 限定名称（ IQN ）映射到一个或多个卷。要访问 VAG 中的卷，启动程序的 IQN 必须位于该卷组允许的 IQN 列表中。
* * 租户虚拟 LAN （ VLAN ）。 * 在网络级别，使用 VLAN 可提高 iSCSI 启动程序与 NetApp Element 软件集群之间的端到端网络安全性。对于为隔离工作负载或租户而创建的任何 VLAN ， NetApp Element 软件会创建一个单独的 iSCSI 目标 SVIP 地址，该地址只能通过特定 VLAN 进行访问。
* 启用了 * VPN 路由 / 转发（ VFR ）的 VLAN 。 * 为了进一步支持数据中心的安全性和可扩展性，您可以使用 NetApp Element 软件为任何租户 VLAN 启用类似 VRF 的功能。此功能增加了以下两项关键功能：
+
** 通过 * L3 路由到租户 SVIP 地址。 * 此功能，您可以将 iSCSI 启动程序置于与 NetApp Element 软件集群不同的网络或 VLAN 上。
** * IP 子网重叠或重复。 * 此功能可用于向租户环境添加模板，从而可以从同一 IP 子网为每个租户 VLAN 分配 IP 地址。对于扩展和保留 IP 空间非常重要的服务提供商环境，此功能非常有用。






===== 企业级存储效率

NetApp Element 软件集群可提高整体存储效率和性能。以下功能是实时执行的，始终开启的，无需用户手动配置：

* * 重复数据删除。 * 系统仅存储唯一的 4 K 块。任何重复的 4K 块都会自动与已存储的数据版本关联。数据位于块驱动器上，并通过 Element Helix 数据保护进行镜像。此系统可显著减少系统中的容量消耗和写入操作。
* * 压缩。 * 数据写入 NVRAM 之前，会实时执行数据压缩。数据会进行压缩，以 4 k 块的形式存储，并在系统中保持压缩状态。这种压缩可显著减少集群中的容量消耗，写入操作和带宽消耗。
* * 精简配置。 * 此功能可在需要时提供适当数量的存储，从而消除因过度配置卷或未充分利用卷而导致的容量消耗。
* * Helix.* 单个卷的元数据存储在元数据驱动器上，并复制到二级元数据驱动器以实现冗余。


* 注： * Element 专为自动化而设计。上述所有存储功能均可通过 API 进行管理。这些 API 是用户界面用来控制系统是直接通过 Element 执行操作还是通过 vSphere Element 插件执行操作的唯一方法。



== VMware vSphere

VMware vSphere 是行业领先的虚拟化解决方案，它基于 VMware ESXi 虚拟机管理程序构建，并由 vCenter Server 管理，可提供企业数据中心通常需要的高级功能。在将 NDE 与 NetApp HCI 结合使用时，会配置并安装 VMware vSphere 环境。部署环境后，可以使用以下功能：

* * 集中式管理。 * 通过 vSphere ，各个虚拟机管理程序可以分组到数据中心并组合到集群中，从而使高级组织可以轻松地对资源进行整体管理。
* * VMware HA 。 * 此功能允许虚拟子系统在其主机不可用时自动重新启动。启用此功能后，虚拟子系统将成为容错系统，当环境中发生物理故障时，虚拟基础架构的中断将降至最低。
* * VMware 分布式资源计划程序（ DRS ）。 * VMware vMotion 允许在满足特定用户定义的阈值时无中断地在主机之间移动子系统。此功能可使虚拟子系统在环境中具有高可用性。
* * vSphere 分布式交换机（ VDS ）。 * 虚拟交换机由 vCenter Server 控制，通过创建映射到每个主机上的物理接口的端口组，可以集中配置和管理每个主机的连接。




== Anthos

Anthos 是一款混合云 Kubernetes 数据中心解决方案，可帮助企业构建和管理现代混合云基础架构，同时采用专注于应用程序开发的灵活工作流。基于 VMware 的 Anthos 是一种基于开源技术的解决方案，在基于 VMware vSphere 的基础架构中在内部运行，该基础架构可以与 Google Cloud 中的 Anthos GKEE 进行连接和互操作。通过采用容器，服务网状和其他转型技术，企业可以在本地和基于云的环境中体验一致的应用程序开发周期和可随时投入生产的工作负载。下图展示了 Anthos 解决方案以及内部数据中心中的部署如何与云中的基础架构互连。有关 Anthos 的详细信息，请参见位于的 Anthos 网站 https://cloud.google.com/anthos/["此处"]。

Anthos 提供以下功能：

* * Anthos 配置管理。 * 自动执行混合 Kubernetes 部署的策略和安全性。
* * Anthos Service mesh 。 * 利用 Istio 支持的服务网格增强应用程序的可观察性，安全性和控制力。
* * 适用于 Kubernetes 应用程序的 Google Cloud Marketplace 。 * 一个精心设计的容器应用程序目录，可用于轻松部署。
* * 迁移 for Anthos.* 将物理服务和 VM 从内部环境自动迁移到云。
* * Stackdriver.* Google 提供的管理服务，用于记录和监控云实例。


image::anthos_architecture.png[Anthos 架构。]



=== 容器和 Kubernetes 流程编排

容器技术已为开发人员提供了很长时间。但是，随着越来越多的企业采用特定于应用程序的工作负载要求， IT 才成为数据中心架构和设计的核心概念。

传统开发环境需要在裸机或虚拟服务器上部署专用开发主机。此类环境要求每个应用程序都有自己的专用计算机，并具有操作系统（ OS ）和网络连接。这些计算机通常必须由企业系统管理团队管理，他们必须考虑安装的应用程序版本以及主机操作系统修补程序。相比之下，按设计部署容器所需的开销更少。只需将应用程序代码和支持库打包在一起，因为所有其他服务都取决于主机操作系统。开发人员可以专注于应用程序开发流程，而不是管理完整的虚拟机（ VM ）环境。

随着容器技术在企业环境中开始受到吸引力，许多企业功能（例如容错和应用程序扩展）都是需要的和预期的。为此， Google 与 Linux 基金会合作，组建了 Cloud 原生计算基金会（ Cloud Computing Foundation ， CNCF ）。他们共同推出了 Kubernetes （ K8s ），这是一个用于编排和管理容器的开源平台。Kubernetes 由 Google 设计，是 Omega 和 Borg 容器管理平台的后继产品，这些平台在其数据中心中已使用过。



=== Anthos GKE

Anthos GKEE 是经过认证的 Kubernetes 在 Google Cloud 中的分销商。它可以让最终用户轻松部署托管的生产就绪型 Kubernetes 集群，使开发人员能够主要专注于应用程序开发，而不是管理其环境。在 Anthos GKEE 中部署 Kubernetes 集群具有以下优势：

* * 简化应用程序部署。 * Anthos GKEE 支持快速开发，部署和更新应用程序和服务。通过简单地描述应用程序容器所需的预期系统资源（计算，内存和存储）， Kubernetes Engine 可以自动配置和管理集群环境的生命周期。
* * 确保集群的可用性。 * 使用 Google Cloud 控制台中内置的信息板，可使环境变得极其易于访问和管理。Google Site Reliability Engineers （ SRE ）会持续监控 Anthos GKEE 集群，通过收集定期指标并观察分配的系统资源的使用情况来确保集群按预期运行。用户还可以利用可用的运行状况检查来确保其部署的应用程序具有高可用性，并在发生异常时轻松恢复。
* * 在 Google Cloud 中保护集群安全。 * 最终用户可以通过自定义 Google Cloud 的全球虚拟私有云中提供的网络策略来确保集群安全且可访问。可以将公有服务放置在一个全局 IP 地址的后面，以实现负载平衡。一个 IP 可以帮助为应用程序提供高可用性，并防止分布式拒绝服务（ DDoS ）和其他可能妨碍服务性能的攻击。
* * 轻松扩展以满足需求。 * 最终用户可以在其集群上启用自动扩展，轻松应对计划内和意外增加的应用程序需求。自动扩展有助于通过在高需求时段增加容量来确保系统资源始终可用。它还允许集群在高峰需求减少后恢复到先前的状态和大小。




=== VMware 上的 Anthos

VMware 上的 Anthos 是部署在最终用户私有数据中心的 Google Kubernetes 引擎的扩展。企业可以部署设计用于在内部 Kubernetes 集群中 Google Cloud 容器中运行的相同应用程序。VMware 上的 Anthos 具有以下优势：

* * 节省成本。 * 最终用户可以通过将自己的物理资源用于应用程序部署，而不是在 Google Cloud 环境中配置资源来显著节省成本。
* * 先开发再发布。 * 在开发应用程序时，可以使用内部部署，这样可以在本地数据中心的隐私环境下测试应用程序，然后再在云中公开发布。
* * 安全要求。 * 安全问题日益增加或无法存储在公有云中的敏感数据集的客户可以从自己的数据中心的安全环境中运行其应用程序，从而满足组织的要求。


link:anthos_reference_design_considerations.html["接下来：设计注意事项"]
