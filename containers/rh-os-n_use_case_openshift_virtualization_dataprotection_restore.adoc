---
sidebar: sidebar 
permalink: containers/rh-os-n_use_case_openshift_virtualization_dataprotection_restore.html 
keywords: OpenShift, OCP, Astra Trident, NetApp ONTAP, Red Hat OpenShift, OpenShift Virtualization, CNV, Container Native Virtualization, Red Hat OpenShift Virtualization, OADP operator, Openshift Data Protection Application operator, velero 
summary: 借助 NetApp ONTAP 实现 Red Hat OpenShift 虚拟化 
---
= 从备份还原虚拟机
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/




== 前提条件

要从备份中还原、我们假设虚拟机所在的命名空间被意外删除。



== 还原到同一命名空间

要从刚刚创建的备份进行还原、需要创建一个还原自定义资源(CR)。我们需要为其提供一个名称、提供要从中还原的备份的名称、并将restorEPVs设置为true。可以按中所示设置其他参数 link:https://docs.openshift.com/container-platform/4.14/backup_and_restore/application_backup_and_restore/backing_up_and_restoring/restoring-applications.html["文档。"]。单击创建按钮。

image::redhat_openshift_OADP_restore_image1.jpg[创建还原CR]

....
apiVersion: velero.io/v1
kind: Restore
metadata:
  name: restore1
  namespace: openshift-adp
spec:
  backupName: backup1
  restorePVs: true
....
当阶段显示完成时、您可以看到虚拟机已还原到创建快照时的状态。(如果备份是在虚拟机运行时创建的、则从备份中还原虚拟机将启动已还原的虚拟机并使其进入运行状态)。VM将还原到同一命名空间。

image::redhat_openshift_OADP_restore_image2.jpg[还原已完成]



== 还原到其他命名空间

要将VM还原到其他命名空间、您可以在Restore CR的YAML定义中提供一个命名空间映射。

以下示例YAML文件会创建一个还原CR、以便在将备份还原到虚拟机命名空间时、还原虚拟机及其磁盘在virtual-Machine-demO命名空间中的位置。

....
apiVersion: velero.io/v1
kind: Restore
metadata:
  name: restore-to-different-ns
  namespace: openshift-adp
spec:
  backupName: backup
  restorePVs: true
  includedNamespaces:
  - virtual-machines-demo
  namespaceMapping:
    virtual-machines-demo: virtual-machines
....
当阶段显示完成时、您可以看到虚拟机已还原到创建快照时的状态。(如果备份是在虚拟机运行时创建的、则从备份中还原虚拟机将启动已还原的虚拟机并使其进入运行状态)。虚拟机将还原到YAML中指定的其他命名空间。

image：：redhat_openshift_OADP_restore_image3.jpg[Restore已完成到新命名空间]%
