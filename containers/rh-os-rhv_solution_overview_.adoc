---
sidebar: sidebar 
permalink: containers/rh-os-rhv_solution_overview.html 
keywords: NVA-1149, Red Hat, virtualization, Openshift, containers, containerized, Trident, KVM, RHV-M 
summary:  
---
= NVA-1149 ：基于 Red Hat 虚拟化的适用于 Red Hat OpenShift 的 NetApp HCI
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


NetApp 公司 Alan Cowles 和 Nikhil M Kulkarni

基于 Red Hat 虚拟化（ RHV ）的 NetApp HCI for Red Hat OpenShift 是一个最佳实践部署指南，用于通过安装程序配置基础架构（ IPI ）方法将 Red Hat OpenShift 完全自动安装到经验证的企业架构上 link:rhv-solution_overview.html["NVA-1148 ：采用 Red Hat 虚拟化的 NetApp HCI"]。本《经验证的 NetApp 架构部署指南》旨在提供一组经过验证的简明说明，以便在部署解决方案时遵循。本文档所述的架构和部署方法已由 NetApp 和 Red Hat 的主题专家联合验证，以提供解决方案的最佳实施实践。



== 用例

基于 RHV 解决方案的 NetApp HCI for Red Hat OpenShift 旨在为客户提供卓越的价值，其使用情形如下：

* 利用 NetApp HCI 实现按需扩展的基础架构
* RHV 中的企业虚拟化工作负载
* Red Hat OpenShift 中的企业级容器化工作负载




== 业务价值

企业越来越多地采用 DevOps 实践来创建新产品，缩短发布周期并快速添加新功能。由于容器和微服务本身的灵活性，它们在支持 DevOps 实践方面发挥着至关重要的作用。但是，在企业环境中以生产规模实施 DevOps 会带来自身的挑战，并对底层基础架构提出一些要求，例如：

* 堆栈中所有层的高可用性
* 易于部署过程
* 无中断运行和升级
* API 驱动的可编程基础架构，可跟上微服务灵活性的步伐
* 具有性能保证的多租户
* 能够同时运行虚拟化和容器化工作负载
* 能够根据工作负载需求独立扩展基础架构


基于 RHV 的 NetApp HCI for Red Hat OpenShift 认可了这些挑战，并提供了一个解决方案，通过在 RHV 企业级虚拟机管理程序上实施完全自动化的 RedHat OpenShift IPI 部署，帮助解决每个问题。本文档其余部分详细介绍了此经验证的架构中使用的组件。



== 技术概述



=== NetApp HCI

NetApp HCI 是一款企业级分解式混合云基础架构（ HCI ）解决方案，可通过一个灵活，可扩展且易于管理的双机架单元（ 2RU ）四节点组件提供计算和存储资源。此外，还可以为其配置 1RU 计算和服务器节点。下图所示的最低部署包括四个 NetApp HCI 存储节点和两个 NetApp HCI 计算节点。计算节点作为 Red Hat 虚拟化主机（ RHP-H ）虚拟机管理程序安装在高可用性（ HA ）集群中。通过添加额外的 NetApp HCI 存储或计算节点以扩展可用资源，可以轻松扩展这种最低部署规模，以满足客户企业工作负载需求。

image:redhat_openshift_image1.png["错误：缺少图形映像"]

适用于 Red Hat 虚拟化的 NetApp HCI 设计在最低初始配置中包含以下组件：

* 运行 NetApp Element 软件的 NetApp H 系列全闪存存储节点
* 运行 Red Hat 虚拟化 RHV-H 虚拟机管理程序的 NetApp H 系列计算节点


有关 NetApp HCI 中计算和存储节点的详细信息，请参见 https://www.netapp.com/us/media/ds-3881.pdf["NetApp HCI 产品规格"^]。



=== NetApp Trident

Trident 是一款完全受支持的 NetApp 开源存储编排程序，适用于容器和 Kubernetes 分发版，包括 Red Hat OpenShift 。它适用于整个 NetApp 存储产品组合，包括作为 NetApp HCI 解决方案一部分部署的 NetApp Element 存储系统。Trident 允许最终用户从其 NetApp 存储系统配置和管理存储，而无需存储管理员干预，从而加快 DevOps 工作流的速度。管理员可以根据项目需求以及支持任意数量高级存储功能的存储系统型号配置多个存储后端，例如：压缩，特定磁盘类型或 QoS 级别，以保证特定性能。定义后，开发人员可以在其项目中利用这些后端来创建永久性卷声明（ Persistent Volume Claim ， PVC ）并按需将永久性存储附加到容器。

image:redhat_openshift_image2.png["错误：缺少图形映像"]



=== Red Hat 虚拟化

RHV 是一个企业级虚拟数据中心平台，运行在 Red Hat Enterprise Linux （ RHEL ）上，并使用 KVM 虚拟机管理程序。

有关 RHV 的详细信息，请参见 https://www.redhat.com/en/technologies/virtualization/enterprise-virtualization["Red Hat 虚拟化网站"^]。

RHV 具有以下功能：

* * 集中管理 VM 和主机。 * 在部署中， RHV 管理器作为物理机或虚拟机（ VM ）运行，并提供一个基于 Web 的图形用户界面，用于从中央界面管理解决方案。
* * 自托管引擎。 * 为最大限度地降低硬件要求， RHV 允许将 RHV Manager （ RHV-M ）部署为运行子虚拟机的主机上的 VM 。
* * 高可用性。 * 如果主机发生故障，为了避免中断，可以通过 RHV 配置虚拟机以实现高可用性。高可用性 VM 可通过故障恢复策略在集群级别进行控制。
* * 高可扩展性。 * 一个 RHV 集群最多可以包含 200 个虚拟机管理程序主机，从而支持大规模虚拟机的要求，以容纳资源耗用的企业级工作负载。
* * 增强的安全性。 * RHV 继承了 RHV 的功能，安全虚拟化（ sVirt ）和安全增强型 Linux （ SELinux ）技术被 RHV 用于提高主机和 VM 的安全性和增强性能。这些功能的主要优势是对虚拟机及其相关资源进行逻辑隔离。




==== Red Hat Virtualization Manager

RHV-M 可为 RHV 虚拟化环境中的物理和逻辑资源提供集中式企业级管理。我们提供了一个基于 Web 的 GUI ，其中包含不同的基于角色的门户，用于访问 RHV-M 功能。

RHV-M 通过开源社区驱动型 RESTful API 公开对 RHV 资源的配置和管理。它还支持与 Red Hat CloudForms 和 Red Hat Ansible 实现全面集成，以实现自动化和流程编排。



==== Red Hat 虚拟化主机

主机（也称为虚拟机管理程序）是为 VM 运行提供硬件资源的物理服务器。基于内核的虚拟机（ KVM ）可提供全面的虚拟化支持，而 Virtual Desktop Server Manager （ VDSM ）是主机代理，负责主机与 RHV-M 之间的通信

RHV 支持两种类型的主机： RH-HH 和 RHEL 主机：

* RHV-H-H 是一款基于 RHEL 的轻型最小操作系统，经过优化，可轻松将物理服务器设置为 RHV 虚拟机管理程序。
* RHEL 主机是运行标准 RHEL 操作系统的服务器，稍后会为其配置所需的订阅，以安装允许将物理服务器用作 RHV 主机所需的软件包。




==== Red Hat 虚拟化架构

RHV 可以部署在两种不同的架构中：将 RHV-M 作为基础架构中的物理服务器，或者将 RHV-M 配置为一个自托管引擎。本部署指南建议并专门使用自托管引擎部署，其中， RHL-M 是在与其他 VM 相同的环境中托管的 VM 。

要使子虚拟机和 RHV-M 实现高可用性，至少需要两个自托管节点，如下图所示。为了确保管理器虚拟机的高可用性， HA 服务已启用并在所有自行托管的引擎节点上运行。

image:redhat_openshift_image3.png["错误：缺少图形映像"]



=== Red Hat OpenShift 容器平台

Red Hat OpenShift 容器平台是一个完全受支持的企业 Kubernetes 平台。Red Hat 对开源 Kubernetes 进行了多项增强，可提供一个应用程序平台，其中包含所有组件，这些组件均已完全集成，可用于构建，部署和管理容器化应用程序。使用 Red Hat OpenShift 4.4 ，可以通过在此解决方案中部署的 IPI 方法简化安装和管理过程。利用此部署方法，可以在不到一小时的时间内在 Red Hat 虚拟化基础上全面配置一个功能完备的 OpenShift 集群，该集群在集群和应用程序级别提供计量和监控功能。OpenShift 节点基于 RHEL CoreOS ， RHEL CoreOS 是一种不可变的系统映像，专用于运行基于 RHEL 的容器，可以根据最终用户的需求轻松地进行升级或扩展，从而帮助将公有云的优势提供给本地数据中心。

image:redhat_openshift_image4.png["错误：缺少图形映像"]

link:rh-os-rhv_architectural_overview.html["接下来：架构概述：基于 RHV 的适用于 Red Hat OpenShift 的 NetApp HCI 。"]
