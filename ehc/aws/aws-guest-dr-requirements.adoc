---
sidebar: sidebar 
permalink: ehc/aws/aws-guest-dr-requirements.html 
keywords: adminstrative, ESXi hosts, VMware vCenter, nsx, MS SQL, oracle, Veeam, cloud, aws, Amazon FSx, vmc 
summary: 本节详细介绍了访问和配置内部资源、VMware Cloud和Amazon FSX ONTAP 的要求。 
---
= 要求
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../../media/


link:aws-guest-dr-overview.html["先前版本：概述—AWS子系统连接存储灾难恢复。"]

本节详细介绍了访问和配置内部资源、VMware Cloud和Amazon FSX ONTAP 的要求。



== 技能和知识

要访问Cloud Volumes Service for AWS、需要以下技能和信息：

* 访问VMware和ONTAP 内部环境并了解相关知识。
* 访问VMware Cloud和AWS并了解相关信息。
* 访问AWS和Amazon FSX ONTAP 并了解这些信息。
* 了解SDDC和AWS资源。
* 了解内部资源与云资源之间的网络连接。
* 具备灾难恢复场景的工作知识。
* 了解在VMware上部署的应用程序的工作知识。




== 管理

无论是在内部还是在云中与资源进行交互、用户和管理员都必须能够并有权根据自己的权限在需要时根据自己的权限在需要的位置配置这些资源。要成功部署混合云、您在内部系统(包括ONTAP 和VMware)以及云资源(包括VMware Cloud和AWS)中的角色和权限之间的交互至关重要。

要使用VMware和ONTAP 内部部署以及基于AWS和FSX ONTAP 的VMware Cloud构建灾难恢复解决方案 、必须执行以下管理任务。

* 启用以下配置的角色和帐户：
+
** ONTAP 存储资源
** VMware VM、数据存储库等
** AWS VPC和安全组


* 配置内部VMware环境和ONTAP
* VMware Cloud环境
* 适用于ONTAP 文件系统的Amazon FSX
* 内部环境与AWS之间的连接
* 连接AWS VPC




== 内部部署

VMware虚拟环境包括ESXi主机、VMware vCenter Server、NSX网络和其他组件的许可、如下图所示。所有这些组件的许可方式都不同、了解底层组件如何使用可用的许可容量非常重要。

image:dr-vmc-aws-image2.png["错误：缺少图形映像、100、100"]



=== ESXi主机

VMware环境中的计算主机是使用ESXi部署的。在不同容量层获得vSphere的许可后、虚拟机可以利用每个主机上的物理CPU以及适用的授权功能。



=== VMware vCenter

管理ESXi主机和存储是VMware管理员可通过vCenter Server使用的众多功能之一。从VMware vCenter 7.0开始、根据许可证的不同、有三个版本的VMware vCenter可用：

* vCenter Server基础知识
* vCenter Server基础版
* vCenter Server标准版




=== VMware NSX

VMware NSX为管理员提供了启用高级功能所需的灵活性。根据获得许可的NSX-T版本启用功能：

* 专业人员
* 高级
* Enterprise Plus
* 远程办公室/分支机构




=== NetApp ONTAP

NetApp ONTAP 许可是指管理员如何访问NetApp存储中的各种功能。许可证是一个或多个软件授权的记录。通过安装许可证密钥(也称为许可证代码)、您可以在存储系统上使用某些功能或服务。例如、ONTAP 支持所有主要的行业标准客户端协议(NFS、SMB、FC、FCoE、iSCSI、 和NVMe/FC)。

Data ONTAP 功能许可证以软件包的形式发布、每个软件包都包含多个功能或一个功能。某个软件包需要许可证密钥、安装该密钥后、您可以访问该软件包中的所有功能。

许可证类型如下：

* *节点锁定许可证。*安装节点锁定许可证可使节点获得许可功能。要使集群能够使用许可的功能，必须至少为一个节点授予使用此功能的许可。
* *主许可证/站点许可证。*主许可证或站点许可证不与特定系统序列号绑定。安装站点许可证时、集群中的所有节点均有权使用许可的功能。
* *演示/临时许可证。*演示或临时许可证将在一段时间后过期。通过此许可证，您可以在不购买授权的情况下尝试某些软件功能。
* *容量许可证(仅限ONTAP Select 和FabricPool)。* ONTAP Select 实例根据用户要管理的数据量获得许可。从ONTAP 9.4开始、FabricPool 要求在第三方存储层(例如AWS)上使用容量许可证。




=== NetApp SnapCenter

SnapCenter 需要多个许可证才能启用数据保护操作。您安装的 SnapCenter 许可证类型取决于您的存储环境和要使用的功能。SnapCenter 标准版许可证可保护应用程序、数据库、文件系统和虚拟机。在将存储系统添加到 SnapCenter 之前，您必须安装一个或多个 SnapCenter 许可证。

要保护应用程序、数据库、文件系统和虚拟机、您必须在FAS 或AFF 存储系统上安装基于控制器的标准许可证、或者在ONTAP Select 和Cloud Volumes ONTAP 平台上安装基于容量的标准许可证。

请参见此解决方案 的以下SnapCenter 备份前提条件：

* 在内部ONTAP 系统上创建的卷和SMB共享、用于查找备份的数据库和配置文件。
* 内部ONTAP 系统与AWS帐户中的FSX或CVO之间的SnapMirror关系。用于传输包含备份的SnapCenter 数据库和配置文件的快照。
* Windows Server安装在云帐户中、可以安装在EC2实例上、也可以安装在VMware Cloud SDDC中的VM上。
* SnapCenter 安装在VMware Cloud中的Windows EC2实例或VM上。




=== MS SQL

在此解决方案 验证中、我们使用MS SQL演示灾难恢复。

有关MS SQL和NetApp ONTAP 最佳实践的详细信息、请参见 https://www.netapp.com/media/8585-tr4590.pdf["此链接。"^]。



=== Oracle

在此解决方案 验证中、我们使用Oracle演示灾难恢复。有关Oracle和NetApp ONTAP 最佳实践的详细信息、请参见 https://www.netapp.com/media/8744-tr3633.pdf["此链接。"^]。



=== Veeam

在此解决方案 验证过程中、我们使用Veeam演示灾难恢复。有关Veeam和NetApp ONTAP 最佳实践的详细信息、请参见 https://www.veeam.com/wp-netapp-configuration-best-practices-guide.html["此链接。"^]。



== 云



=== AWS

您必须能够执行以下任务：

* 部署和配置域服务。
* 在给定VPC中根据应用程序要求部署FSX ONTAP。
* 在AWS计算网关上配置VMware Cloud、以允许来自FSX ONTAP 的流量。
* 配置AWS安全组、以允许AWS子网上的VMware Cloud与部署了FSX ONTAP 服务的AWS VPC子网之间进行通信。




=== VMware Cloud

您必须能够执行以下任务：

* 在AWS SDDC上配置VMware Cloud。




=== Cloud Manager帐户验证

您必须能够使用NetApp Cloud Manager部署资源。要验证是否可以、请完成以下任务：

* https://docs.netapp.com/us-en/cloud-manager-setup-admin/task-signing-up.html["注册Cloud Central"^] 如果您尚未执行此操作。
* https://docs.netapp.com/us-en/cloud-manager-setup-admin/task-logging-in.html["登录到Cloud Manager"^]。
* https://docs.netapp.com/us-en/cloud-manager-setup-admin/task-setting-up-netapp-accounts.html["设置工作空间和用户"^]。
* https://docs.netapp.com/us-en/cloud-manager-setup-admin/concept-connectors.html["创建连接器"^]。




=== 适用于 NetApp ONTAP 的 Amazon FSX

拥有AWS帐户后、您必须能够执行以下任务：

* 创建一个能够为NetApp ONTAP 文件系统配置Amazon FSX的IAM管理用户。




== 配置前提条件

鉴于客户拥有不同的拓扑结构、本节重点介绍实现从内部资源到云资源的通信所需的端口。



=== 所需端口和防火墙注意事项

下表介绍了必须在整个基础架构中启用的端口。

有关Veeam Backup & Replication软件所需端口的更全面列表、请按照 https://helpcenter.veeam.com/docs/backup/vsphere/used_ports.html?zoom_highlight=port+requirements&ver=110["此链接。"^]。

有关SnapCenter 的端口要求的更全面列表、请按 https://docs.netapp.com/ocsc-41/index.jsp?topic=%2Fcom.netapp.doc.ocsc-isg%2FGUID-6B5E4464-FE9A-4D2A-B526-E6F4298C9550.html["此链接。"^]。

下表列出了Microsoft Windows Server的Veeam端口要求。

|===
| from | 收件人： | 协议 | Port | 注释： 


| 备份服务器 | Microsoft Windows服务器 | TCP | 445 | 部署Veeam Backup & Replication组件所需的端口。 


| 备份代理 |  | TCP | 6160 | Veeam安装程序服务使用的默认端口。 


| 备份存储库 |  | TCP | 2500到3500 | 用作数据传输通道和收集日志文件的默认端口范围。 


| 挂载服务器 |  | TCP | 6162 | Veeam Data Mover使用的默认端口。 
|===

NOTE: 对于作业使用的每个TCP连接、都会为此范围分配一个端口。

下表列出了Linux Server的Veeam端口要求。

|===
| from | 收件人： | 协议 | Port | 注释： 


| 备份服务器 | Linux服务器 | TCP | 22. | 用作从控制台到目标Linux主机的控制通道的端口。 


|  |  | TCP | 6162 | Veeam Data Mover使用的默认端口。 


|  |  | TCP | 2500到3500 | 用作数据传输通道和收集日志文件的默认端口范围。 
|===

NOTE: 对于作业使用的每个TCP连接、都会为此范围分配一个端口。

下表列出了Veeam Backup Server的端口要求。

|===
| from | 收件人： | 协议 | Port | 注释： 


| 备份服务器 | vCenter Server | HTTPS、TCP | 443. | 用于连接到vCenter Server的默认端口。用作从控制台到目标Linux主机的控制通道的端口。 


|  | 托管Veeam Backup & Replication配置数据库的Microsoft SQL Server | TCP | 1443 | 用于与部署Veeam Backup & Replication配置数据库的Microsoft SQL Server进行通信的端口(如果使用Microsoft SQL Server默认实例)。 


|  | 所有备份服务器的名称解析DNS服务器 | TCP | 3389 | 用于与DNS服务器通信的端口 
|===

NOTE: 如果使用vCloud Director、请确保打开底层vCenter Server上的端口443。

下表列出了Veeam Backup Proxy端口要求。

|===
| from | 收件人： | 协议 | Port | 注释： 


| 备份服务器 | 备份代理 | TCP | 6210 | Veeam Backup VSS集成服务用于在SMB文件共享备份期间创建VSS快照的默认端口。 


| 备份代理 | vCenter Server | TCP | 1443 | 可在vCenter设置中自定义的默认VMware Web服务端口。 
|===
下表列出了SnapCenter 端口要求。

|===
| 端口类型 | 协议 | Port | 注释： 


| SnapCenter 管理端口 | HTTPS | 8146 | 此端口用于SnapCenter 客户端(SnapCenter 用户)与SnapCenter 服务器之间的通信。也用于从插件主机到 SnapCenter 服务器的通信。 


| SnapCenter SMCore 通信端口 | HTTPS | 8043 | 此端口用于在SnapCenter 服务器与安装SnapCenter 插件的主机之间进行通信。 


| Windows插件主机、安装 | TCP | 135、445 | 这些端口用于在SnapCenter 服务器与要安装此插件的主机之间进行通信。这些端口可以在安装后关闭。此外、Windows Instrumentation Services还会搜索端口49152到65535、这些端口必须处于打开状态。 


| Linux插件主机、安装 | SSH | 22. | 这些端口用于在SnapCenter 服务器与要安装此插件的主机之间进行通信。SnapCenter 使用这些端口将插件软件包二进制文件复制到Linux插件主机。 


| 适用于Windows/Linux的SnapCenter 插件软件包 | HTTPS | 8145 | 此端口用于在SMCore与安装了SnapCenter 插件的主机之间进行通信。 


| VMware vSphere vCenter Server 端口 | HTTPS | 443. | 此端口用于在适用于VMware vSphere的SnapCenter 插件与vCenter服务器之间进行通信。 


| 适用于VMware vSphere的SnapCenter 插件端口 | HTTPS | 8144 | 此端口用于从vCenter vSphere Web Client和SnapCenter 服务器进行通信。 
|===
link:aws-guest-dr-networking.html["下一步：网络连接。"]
