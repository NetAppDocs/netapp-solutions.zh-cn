---
sidebar: sidebar 
permalink: infra/hcicaci_kvm_on_rhel.html 
keywords: KVM, Kernel-based, Virtual Machine, linux, workflow 
summary: TR-4857 
---
= 基于 RHEL 的 KVM ：采用 Cisco ACI 的 NetApp HCI
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
KVM （适用于基于内核的虚拟机）是一种适用于 Linux 的开源完全虚拟化解决方案，它位于 Intel VT 或 AMD-V 等 x86 硬件上换言之， KVM 可让您将 Linux 计算机转变为虚拟机管理程序，从而使主机能够运行多个隔离的 VM 。

KVM 可将任何 Linux 计算机转换为 1 类（裸机）虚拟机管理程序。KVM 可以在任何 Linux 分发版上实施，但在支持的 Linux 分发版上实施 KVM―与 Red Hat Enterprise Linux―一样，可扩展 KVM 的功能。您可以在子系统之间交换资源，共享通用库以及优化系统性能。



== 工作流

以下高级工作流用于设置虚拟环境。其中每个步骤可能涉及多个单独的任务。

. 在 ACI 模式下安装和配置 Nexus 9000 交换机，并在 UCS C 系列服务器上安装和配置 APIC 软件。请参见安装和升级 https://www.cisco.com/c/en/us/support/cloud-systems-management/application-policy-infrastructure-controller-apic/tsd-products-support-series-home.html["文档。"^] 了解详细步骤。
. 请参阅配置和设置 ACI 网络结构 https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/3-x/getting_started/b_APIC_Getting_Started_Guide_Rel_3_x.html["文档。"^]。
. 配置 NetApp HCI 节点所需的租户，应用程序配置文件，网桥域和 EPG 。NetApp 建议使用除 iSCSI 之外的一个 BD-1-EPG 框架。请参见文档 https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/2-x/L2_config/b_Cisco_APIC_Layer_2_Configuration_Guide.html["此处"^] 有关详细信息：所需的最小 EPG 集包括带内管理， iSCSI ， VM Motion ， VM 数据网络和原生。
. 根据要求创建 VLAN 池，物理域和 AEP 。为 VPC 和各个端口创建交换机和接口配置文件和策略。然后连接物理域并配置指向 EPG 的静态路径。请参见 https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/2-x/L2_config/b_Cisco_APIC_Layer_2_Configuration_Guide.html["配置指南"^] 有关详细信息：另请参见此表 <link> ，了解在 RHEL – KVM 虚拟机管理程序上将 ACI 与 Open vSwitch 集成的最佳实践。
+

NOTE: 对于连接到 NetApp HCI 存储和计算节点的接口，请使用 vPC 策略组。

. 创建和分配合同，以便在工作负载之间进行严格控制的访问。有关配置合同的详细信息，请参见指南 https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/1-x/Operating_ACI/guide/b_Cisco_Operating_ACI/b_Cisco_Operating_ACI_chapter_01000.html["此处"^]。
. 安装和配置 NetApp HCI Element 集群。请勿在此安装中使用 NDE ；而是在 HCI 存储节点上安装独立的 Element 集群。然后，配置安装 RHEL 所需的卷。在 NetApp HCI 计算节点上安装 RHEL ， KVM 和 Open vSwitch 。使用 Element 卷为主机和 VM 的共享存储服务配置虚拟机管理程序上的存储池。有关在 RHEL 上安装和配置 KVM 的详细信息，请参见 https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/virtualization_deployment_and_administration_guide/index["Red Hat 文档"^]。请参见 有关配置 Open vSwitch 的详细信息。
. RHEL KVM 虚拟机管理程序的 Open vSwitch 无法与 Cisco ACI 集成 VMM 。必须在所有必需的 EPG 上配置物理域和静态路径，以便在连接 ACI 叶交换机和 RHEL 主机的接口上使用所需的 VLAN 。此外，还可以在 RHEL 主机上配置相应的 OVS 网桥，并配置 VM 以使用这些网桥。此解决方案中的 RHEL KVM 主机的网络功能可通过 Open vSwitch 虚拟交换机实现。




== 打开 vSwitch

Open vSwitch 是一款开源企业级虚拟交换机平台。它使用虚拟网络网桥和流量规则在主机之间转发数据包。编程流规则在 OVS 中的工作方式与在标准 Linux 网桥中不同。OVS 插件不使用 VLAN 标记流量。相反，它会在虚拟交换机上设置流量规则，规定在将流量转发到退出接口之前应如何处理流量。流量规则用于确定应如何处理入站和出站流量。下图显示了基于 RHEL 的 KVM 主机上 Open vSwitch 的内部网络连接。

image:hcicaci_image21.jpeg["错误：缺少图形映像"]

下表概括了在基于 RHEL 的 KVM 主机上配置 Cisco ACI 和 Open vSwitch 所需的参数和最佳实践。

|===
| 资源 | 配置注意事项 | 最佳实践 


| 端点组  a| 
* 原生 VLAN 使用单独的 EPG
* 在原生 VLAN EPG 中，将接口与 HCI 存储和计算节点的静态绑定设置为 802.1p 模式
* 安装 KVM 之前，需要在带内管理 EPG 和 iSCSI EPG 上静态绑定 vPC

 a| 
* 为启用了静态分配的物理域单独分配 VLAN 池
* EPG 之间的合同需要明确定义。仅允许所需端口进行通信。
* 在元素集群形成期间，使用唯一的原生 VLAN 进行发现




| 接口策略  a| 
* 每个 RHEL 主机一个 vPC 策略组
* 每个 NetApp HCI 存储节点一个 vPC 策略组
* 已启用 LLDP ， CDP 已禁用

 a| 
* NetApp 建议对 RHV-HH 主机使用 vPC
* 对端口通道策略使用 LACP Active
* 端口通道策略仅使用正常融合和对称哈希控制位
* 对端口通道策略使用第 4 层 src-Port 负载平衡哈希方法
* NetApp 建议对指向 NetApp HCI 存储节点的接口使用具有 LACP 活动端口通道策略的 vPC


|===
link:hcicaci_ontap_on_aff.html["接下来： ONTAP 上的 AFF ： NetApp HCI 和 Cisco ACI"]
