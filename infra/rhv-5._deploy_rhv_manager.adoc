---
sidebar: sidebar 
permalink: infra/rhv-5._deploy_rhv_manager.html 
keywords: install, virtualization manager, self-hosted, hosted engine, RHV 
summary:  
---
= 5. 将 RHV 管理器部署为一个自助托管引擎：具有 RHV 的 NetApp HCI
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
本节介绍将 Red Hat Virtualization Manager 安装为自托管引擎的详细步骤。这些步骤将在注册 RHV 主机并可访问 Cockpit GUI 之后开始。

. 使用根凭据登录到位于 `https://<HostFQDN/IP>:9090` 的一个 RHV 主机的 Cockpit GUI 。导航到虚拟化子选项卡，然后单击托管引擎。然后，单击托管引擎内容下方的 " 开始 " 按钮以启动引擎部署。
+
image:redhat_virtualization_image41.png["错误：缺少图形映像"]

. 在引擎部署的第一个屏幕中，为引擎虚拟机（至少 4 个 CPU 和 16 GB 内存）配置 RHV-M FQDN ，网络相关配置，根密码和资源。根据需要确认其他配置设置，然后单击下一步。
+
image:redhat_virtualization_image42.jpg["错误：缺少图形映像"]

+

NOTE: 确保引擎 VM FQDN 可由指定的 DNS 服务器解析。

. 在下一屏幕中，输入管理员门户密码。或者，输入要通过电子邮件发送的警报的通知设置。然后单击下一步。
+
image:redhat_virtualization_image43.jpg["错误：缺少图形映像"]

. 在下一屏幕中，查看引擎 VM 的配置。如果需要进行任何更改，请在此时返回并进行更改。如果信息正确，请单击 Prepare the VM 。
+
image:redhat_virtualization_image44.jpg["错误：缺少图形映像"]

. VM 安装将开始，并且可能需要一段时间才能完成，因为它会下载计算机映像并在本地对 VM 进行分阶段。完成后，它将显示 Execution completed successfully 消息。单击下一步。
+
image:redhat_virtualization_image45.jpg["错误：缺少图形映像"]

. 安装完 RHV-M 后，输入托管引擎存储域的详细信息，以便将虚拟机从本地存储复制到共享存储域，从而提高高可用性引擎仲裁。
. 以 iSCSI 形式输入存储类型，提供 iSCSI 门户详细信息，单击检索目标列表，提取与该门户对应的 iSCSI 目标列表，然后选择要映射到托管引擎存储域的卷和 LUN 。单击下一步。
+
image:redhat_virtualization_image46.jpeg["错误：缺少图形映像"]

+

NOTE: 如果托管引擎设置无法发现存储，请打开与节点的交互式 SSH 会话，并验证您是否可以通过节点的存储接口访问 SVIP IP 地址。如果网络可访问，您可能需要手动发现或登录到用于托管引擎安装的 iSCSI LUN 。

. 在下一屏幕中，查看存储配置，如果需要进行任何更改，请返回并进行更改。如果信息正确，请单击完成部署。将虚拟机复制到存储域需要一段时间。部署完成后，单击关闭。
+
image:redhat_virtualization_image47.jpg["错误：缺少图形映像"]

. 下一步是注册并启用 Red Hat Virtualization Manager 存储库。使用 SSH 登录到 RHV-M 虚拟机，以便将其注册到订阅管理器中。
+
....
# subscription-manager register
Registering to: subscription.rhsm.redhat.com:443/subscription
Username: redhat_user
Password:  redhat_password
The system has been registered with ID: 99d06fcb-a3fd74-41230f-bad583-0ae61264f9a3
The registered system name is: rhv-m.cie.netapp.com
....
. 注册后，列出可用的订阅并记录 RHV-M 的池 ID
+
....
# subscription-manager list --available
<snip>
Subscription Name:   Red Hat Virtualization Manager
Provides:            Red Hat Beta
                     Red Hat Enterprise Linux Server
                     Red Hat CodeReady Linux Builder for x86_64
                     Red Hat Enterprise Linux for x86_64
                     Red Hat Virtualization Manager
                     Red Hat OpenShift Container Platform
                     Red Hat Ansible Engine
                     Red Hat Enterprise Linux Fast Datapath
                     Red Hat JBoss Core Services
                     JBoss Enterprise Application Platform
SKU:                 RV00045
Contract:
Pool ID:             8a85f9937a1a2a57c0171a366b5682540112a313 ß Pool ID
Provides Management: No
Available:           6
Suggested:           0
Service Type:        L1-L3
Roles:
Service Level:       Layered
Usage:
Add-ons:
Subscription Type:   Stackable
Starts:              04/22/2020
Ends:                04/21/2021
Entitlement Type:    Physical
<snip>
....
. 使用记录的池 ID 附加 RHV-M 订阅。
+
....
# subscription-manager attach --pool=8a85f9937a1a2a57c0171a366b5682540112a313
Successfully attached a subscription for: Red Hat Virtualization Manager
....
. 启用所需的 RHV-M 存储库。
+
....
# subscription-manager repos \
    --disable='*' \
    --enable=rhel-7-server-rpms \
    --enable=rhel-7-server-supplementary-rpms \
    --enable=rhel-7-server-rhv-4.3-manager-rpms \
    --enable=rhel-7-server-rhv-4-manager-tools-rpms \
    --enable=rhel-7-server-ansible-2-rpms \
    --enable=jb-eap-7.2-for-rhel-7-server-rpms
Repository 'rhel-7-server-ansible-2-rpms' is enabled for this system.
Repository 'rhel-7-server-rhv-4-manager-tools-rpms' is enabled for this system.
Repository 'rhel-7-server-rhv-4.3-manager-rpms' is enabled for this system.
Repository 'rhel-7-server-rpms' is enabled for this system.
Repository 'jb-eap-7.2-for-rhel-7-server-rpms' is enabled for this system.
Repository 'rhel-7-server-supplementary-rpms' is enabled for this system.
....
. 接下来，创建一个存储域，用于存放与主机位于同一数据中心的所有 VM 的 VM 磁盘或 OVF 文件。
. 要使用浏览器登录到 RHV-M 管理门户，请登录到 `https://<ManagerFQDN>/ovirt-engine` ，选择管理门户，然后以 `admin` `@` `internal` user 身份登录。
. 导航到 " 存储 ">" 存储域 " ，然后单击 " 新建域 " 。
. 从下拉菜单中，为域功能选择数据，为存储类型选择 iSCSI ，选择要映射卷的主机，输入所选名称，确认数据中心是否正确，然后展开数据域 iSCSI 目标并添加 LUN 。单击确定以创建域。
+
image:redhat_virtualization_image48.jpg["错误：缺少图形映像"]

+

NOTE: 如果托管引擎设置无法发现存储，您可能需要手动发现或登录到用于数据域的 iSCSI LUN 。

. 将第二个主机添加到托管引擎仲裁。导航到 Compute > Hosts ，然后单击 New 。在 New Host 窗格中，选择相应的集群，提供第二台主机的详细信息，然后选中安装后激活主机复选框。
+
image:redhat_virtualization_image49.jpg["错误：缺少图形映像"]

. 单击 New Host 窗格下拉列表中的 Hosted Engine 子选项卡，然后从 Hosted Engine 部署操作中选择 Deploy 。单击确定将主机添加到仲裁。此时将开始安装支持托管引擎所需的软件包并激活主机。此过程可能需要一段时间。
+
image:redhat_virtualization_image50.png["错误：缺少图形映像"]

. 接下来，为主机创建存储虚拟网络。导航到 " 网络 ">" 网络 " ，然后单击 " 新建 " 。输入您选择的名称，启用 VLAN 标记，然后输入存储网络的 VLAN ID 。确认已选中 VM Network 复选框，并且 MTU 已设置为 9000 。转到 "Cluster" 子选项卡，并确保选中 "Attach and require" 。然后，单击确定以创建存储网络。
+
image:redhat_virtualization_image51.png["错误：缺少图形映像"]

. 将存储逻辑网络分配给集群中的第二个主机或当前未托管托管托管引擎 VM 的任何主机。
. 导航到 Compute > Hosts ，然后在第二列中单击具有银冠的主机。然后，导航到 Network Interfaces 子选项卡，单击 Setup Host Networks ，然后将存储逻辑网络拖放到 bond0 右侧的 Assigned Logical Networks 列中。
+
image:redhat_virtualization_image52.png["错误：缺少图形映像"]

. 单击存储网络接口上 bond0 下的笔形符号。配置 IP 地址和网络掩码，然后单击确定。在设置主机网络窗格中再次单击确定。
+
image:redhat_virtualization_image53.png["错误：缺少图形映像"]

. 将托管引擎 VM 迁移到刚刚配置的主机，以便在第二台主机上配置存储逻辑网络。导航到 Compute > Virtual Machines ，单击 HostedEngine ，然后单击 Migrate 。从目标主机下拉菜单中选择第二个主机，然后单击迁移。
+
image:redhat_virtualization_image54.png["错误：缺少图形映像"]

+
成功迁移并将托管引擎 VM 迁移到第二台主机后，对当前拥有银冠的主机重复步骤 21 和 22 。

. 完成此过程后，您应看到两个主机均已启动。其中一个主机具有一个黄金冠，表示它正在托管托管托管引擎 VM ，而另一个主机则具有一个银冠，表示它能够托管托管托管托管引擎 VM 。


image:redhat_virtualization_image55.png["错误：缺少图形映像"]

link:rhv-6._configure_rhv-m_infrastructure.html["下一步： 6.配置 RHV-M 基础架构"]
