---
sidebar: sidebar 
permalink: infra/rhv-4._deploy_rhv-h_hypervisor.html 
keywords: self-hosted, RHV-H hypervisor, HCI, compute nodes, VLAN, bond configuration 
summary:  
---
= 4. 在 HCI 计算节点：采用 RHV 的 NetApp HCI 上部署 RHV-H 虚拟机管理程序
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
此解决方案采用建议的 RHV 部署自行托管引擎架构，并且设置最少（两个自托管引擎节点）。这些步骤将在节点已进行机架安装和布线，并且已在每个节点上配置 IPMI 端口以使用控制台后开始。要在 HCI 计算节点上部署 RHV-H 虚拟机管理程序，请完成以下步骤：

. 访问集群中计算节点的带外管理控制台，并使用默认凭据 admin/admin 登录。
+
image:redhat_virtualization_image5.png["错误：缺少图形映像"]

. 单击屏幕中央的 "Remote Console Preview" 图像下载 Java Web Start 启动的 JNLP 文件，该文件将启动系统的交互式控制台。
. 启动虚拟控制台后，通过导航到并单击 Virtual Media > Virtual Storage 来连接 HV-H4.3.9 ISO 。
+
image:redhat_virtualization_image17.jpeg["错误：缺少图形映像"]

. 对于逻辑驱动器类型，从下拉列表中选择 ISO 文件。提供 RHV-H-H 4 的完整路径和全名。3.9 ISO 文件或单击打开映像按钮附加该文件。然后单击插件。
+
image:redhat_virtualization_image18.png["错误：缺少图形映像"]

. 通过导航并单击 " 电源控制 ">" 设置电源重置 " ，重新启动服务器，以便使用 RHV-H4.3.9 ISO 进行启动。
+
image:redhat_virtualization_image19.jpg["错误：缺少图形映像"]

. 当节点重新启动并显示初始屏幕时，按 F11 进入启动菜单。从启动菜单中，导航到并单击 ATEN Virtual CDROM/YSOJ 。
+
image:redhat_virtualization_image20.jpeg["错误：缺少图形映像"]

. 在下一屏幕中，导航到并单击安装 RHV 4.3 。此操作将加载映像，运行预安装脚本并启动 Red Hat Enterprise Linux 系统安装程序 Anacondation 。
+
image:redhat_virtualization_image21.png["错误：缺少图形映像"]

. 此时将显示安装欢迎屏幕。选择首选语言，然后单击下一步。
+
image:redhat_virtualization_image22.png["错误：缺少图形映像"]

. 在下一个屏幕中，在日期和时间下选择您的时区。默认值为 UTC 。但是， NetApp 建议您在此屏幕上为您的环境配置 NTP 服务器。然后选择键盘语言并单击 Done 。
+
image:redhat_virtualization_image23.png["错误：缺少图形映像"]

. 接下来，单击安装目标。在安装目标屏幕中，选择要安装 RHV-H 的驱动器验证是否已在分区部分中选择自动配置分区。或者，您也可以选中加密我的数据旁边的框来启用加密。单击 Done 确认设置。
+
image:redhat_virtualization_image24.png["错误：缺少图形映像"]

. 单击网络和主机名。在屏幕底部提供所需的主机名。然后单击底部的（ + ）按钮。从下拉列表中选择 Bond ，然后单击 Add 。
+
image:redhat_virtualization_image25.png["错误：缺少图形映像"]

. 接下来，在绑定配置屏幕中，单击添加将成员接口添加到绑定接口。
+
image:redhat_virtualization_image26.png["错误：缺少图形映像"]

. 从下拉列表中选择以太网，表示以太网接口已添加为绑定接口的成员。单击创建。
+
image:redhat_virtualization_image27.png["错误：缺少图形映像"]

. 从从 1 配置屏幕的设备下拉列表中，选择以太网接口。验证 MTU 是否设置为 9000 。单击保存。
+
image:redhat_virtualization_image28.png["错误：缺少图形映像"]

. 重复步骤 12 ， 13 和 14 ，将另一个以太网端口添加到 bond0 接口。
. 从绑定配置屏幕的模式下拉列表中，为 LACP 选择 802.3ad 。验证 MTU 是否设置为 9000 。然后单击保存。
+
image:redhat_virtualization_image29.png["错误：缺少图形映像"]

. 为带内管理网络创建 VLAN 接口。再次单击（ + ）按钮，从下拉列表中选择 VLAN ，然后单击创建。
+
image:redhat_virtualization_image30.jpg["错误：缺少图形映像"]

. 在编辑 VLAN 连接屏幕的父接口下拉列表中选择 bond0 ，输入带内管理网络的 VLAN ID 。以 `bond` `0.<` `vlan_id` ` >` 格式提供 VLAN 接口的名称。
+
image:redhat_virtualization_image31.jpg["错误：缺少图形映像"]

. 在编辑 VLAN 连接屏幕中，单击 IPv4 设置子选项卡。在 IPv4 设置子选项卡中，配置与带内管理网络对应的网络地址，网络掩码，网关和 DNS 服务器。单击保存以确认设置。
+
image:redhat_virtualization_image32.jpg["错误：缺少图形映像"]

. 为存储网络创建 VLAN 接口。再次单击（ + ）按钮，从下拉列表中选择 VLAN ，然后单击创建。在编辑 VLAN 连接屏幕的父接口下拉列表中选择 bond0 ，输入存储网络的 VLAN ID ，并以 `bond` `0.<` `vlan_id` ` >` 格式提供 VLAN 接口的名称。将 MTU 调整为 9000 以支持巨型帧。单击保存。
+
image:redhat_virtualization_image33.png["错误：缺少图形映像"]

. 在编辑 VLAN 连接屏幕中，单击 IPv4 设置子选项卡。在 IPv4 设置子选项卡中，配置与存储网络对应的网络地址和网络掩码。单击保存以确认设置。
+
image:redhat_virtualization_image34.jpg["错误：缺少图形映像"]

. 确认网络接口已启动，然后单击 Done 。
+
image:redhat_virtualization_image35.jpg["错误：缺少图形映像"]

. 向导导航回配置页面后，单击 Begin Installation 。下一个屏幕将提示您配置根密码，并可选择创建另一个用户以登录到 RHV-H
+
image:redhat_virtualization_image36.png["错误：缺少图形映像"]

. 安装完成后，通过导航到虚拟控制台中的 Virtual media > Virtual Storage 并单击插件来卸载 ISO 文件。然后，在 Anacondas 图形用户界面上单击重新启动以完成安装过程。然后，此节点将重新启动。
+
image:redhat_virtualization_image37.png["错误：缺少图形映像"]

+
节点启动后，它将显示登录屏幕。

+
image:redhat_virtualization_image38.jpg["错误：缺少图形映像"]

. 安装完成后，您必须注册 HV-HH 并启用所需的存储库。打开浏览器，然后使用安装期间提供的根凭据登录到 Cockpit 用户界面，网址为 `https://<HostFQDN/IP>:9090` 。
+
image:redhat_virtualization_image39.png["错误：缺少图形映像"]

. 导航到 localhost > 订阅，然后单击注册。输入您的 Red Hat Portal 用户名和密码，单击将此系统连接到 Red Hat Insights 复选框，然后单击注册。系统会自动订阅 Red Hat 虚拟化主机授权。
+
Red Hat Insights 可对已注册系统进行持续分析，从而主动识别物理，虚拟和云环境中对可用性，安全性，性能和稳定性的威胁。

+
image:redhat_virtualization_image40.png["错误：缺少图形映像"]

. 导航到 localhost > Terminal 以显示命令行界面。您也可以使用任何 SSH 客户端登录到 RHV- H 命令行界面。确认已附加所需的订阅，然后启用 Red Hat Virtualization Host 7 存储库以允许进一步更新，并确保所有其他存储库均已禁用。
+
....
# subscription-manager list
+-------------------------------------------+
    Installed Product Status
+-------------------------------------------+
Product Name:   Red Hat Virtualization Host
Product ID:     328
Version:        4.3
Arch:           x86_64
Status:         Subscribed
# subscription-manager repos --disable=*
Repository 'rhel-7-server- rhvh-4-source-rpms' is disabled for this system.
Repository 'rhvh-4-build-beta-for-rhel-8-x86_64-source-rpms' is disabled for this system.
Repository 'rhel-7-server- rhvh-4-beta-debug-rpms' is disabled for this system.
Repository 'rhvh-4-beta-for-rhel-8-x86_64-debug-rpms' is disabled for this system.
Repository 'jb-eap-textonly-1-for-middleware-rpms' is disabled for this system.
Repository 'rhvh-4-build-beta-for-rhel-8-x86_64-rpms' is disabled for this system.
Repository 'rhvh-4-beta-for-rhel-8-x86_64-source-rpms' is disabled for this system.
Repository 'rhel-7-server- rhvh-4-debug-rpms' is disabled for this system.
Repository 'rhvh-4-build-beta-for-rhel-8-x86_64-debug-rpms' is disabled for this system.
Repository 'rhel-7-server- rhvh-4-beta-source-rpms' is disabled for this system.
Repository 'rhel-7-server- rhvh-4-rpms' is disabled for this system.
Repository 'jb-coreservices-textonly-1-for-middleware-rpms' is disabled for this system.
Repository 'rhvh-4-beta-for-rhel-8-x86_64-rpms' is disabled for this system.
Repository 'rhel-7-server- rhvh-4-beta-rpms' is disabled for this system.
# subscription-manager repos --enable=rhel-7-server- rhvh-4-rpms
Repository 'rhel-7-server- rhvh-4-rpms' is enabled for this system.
....
. 在控制台中，运行以下命令，修改 iSCSI 启动程序 ID ，使其与先前在 Element 访问组中设置的 ID 匹配。
+
....
rhv-h01 # echo InitiatorName=iqn.1994-05.com.redhat:rhv-host-node- 01 > /etc/iscsi/initiatorname.iscsi
....
. 启用并重新启动 iscsid 服务。
+
....
 # systemctl enable iscsid
Created symlink from /etc/systemd/system/multi-user.target.wants/iscsid.service to /usr/lib/systemd/system/iscsid.service
 # systemctl start iscsid
 # systemctl status iscsid
● iscsid.service - Open-iSCSI
   Loaded: loaded (/usr/lib/systemd/system/iscsid.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2020-05-14 16:08:52 EDT; 3 days ago
     Docs: man:iscsid(8)
           man:iscsiuio(8)
           man:iscsiadm(8)
 Main PID: 5422 (iscsid)
   Status: "Syncing existing session(s)"
   CGroup: /system.slice/iscsid.service
           ├─5422 /sbin/iscsid -f
           └─5423 /sbin/iscsid -f
....
. 重复步骤 1 至 29 ，安装并准备另一个 RHV 主机。


link:rhv-5._deploy_rhv_manager.html["下一步： 5.将 RHV Manager 部署为一个自托管引擎"]
