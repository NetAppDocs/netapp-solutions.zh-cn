---
sidebar: sidebar 
permalink: infra/rhv-solution_overview.html 
keywords: NVA-1148, HCI, Design, hyperconverged infrastructure, best practices, Element, QoS, RHV, Red Hat, virtualization 
summary:  
---
= NVA-1148 ：采用 Red Hat 虚拟化的 NetApp HCI
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


NetApp 公司 Nikhil M Kulkarni 的 Alan Cowles

采用 Red Hat 虚拟化的 NetApp HCI 是一种经验证的最佳实践架构，用于以可靠的方式部署内部虚拟数据中心环境。

本架构参考文档可作为解决方案上 Red Hat Virtualization NetApp HCI 的设计指南和部署验证。本文档所述的架构已通过 NetApp 和 Red Hat 的主题专家的验证，可为在您自己的企业数据中心环境中使用基于 NetApp HCI 的 Red Hat 虚拟化进行企业虚拟数据中心部署提供最佳实践实施。



=== 用例

基于 Red Hat 虚拟化解决方案的 NetApp HCI for Red Hat OpenShift 旨在为客户提供卓越的价值，其使用情形如下：

. 利用 NetApp HCI 实现按需扩展的基础架构
. Red Hat 虚拟化中的企业虚拟化工作负载




=== NetApp HCI 与 Red Hat 虚拟化的价值主张和差异化优势

NetApp HCI 在此虚拟基础架构解决方案中具有以下优势：

* 一种可独立扩展计算和存储的分解架构。
* 消除独立 NetApp HCI 存储节点上的虚拟化许可成本和性能税。
* NetApp Element 存储可为每个存储卷提供服务质量（ QoS ），并为 NetApp HCI 上的工作负载提供有保障的存储性能，从而防止相邻工作负载对性能产生负面影响。
* 借助 NetApp 提供支持的 Data Fabric ，可以将数据从内部位置复制到内部位置或复制到云中，从而使数据更接近应用程序需要数据的位置。
* 通过 NetApp 支持或 Red Hat 支持提供支持。




=== NetApp HCI 设计

NetApp HCI 是业内首款领先的分解式混合云基础架构，可提供超融合解决方案的广泛认可优势。其优势包括降低了 TCO ，简化了虚拟化工作负载的采集，部署和管理，同时还允许企业客户根据需要独立扩展计算和存储资源。采用 Red Hat 虚拟化的 NetApp HCI 提供了一个基于 Red Hat Enterprise Linux 的开源企业虚拟化环境。

通过提供灵活的统包基础架构平台， NetApp HCI 可以帮助您加快运行企业级虚拟化和容器化工作负载的速度。NetApp HCI 的核心设计旨在提供可预测的性能，计算和存储资源的线性可扩展性以及简单的部署和管理体验。



==== 可预测

在多租户环境中，最大的挑战之一是为所有工作负载提供一致且可预测的性能。运行多个企业级工作负载可能会导致资源争用，其中一个工作负载会影响另一个工作负载的性能。NetApp HCI 通过 NetApp Element 软件本机提供的存储服务质量（ QoS ）限制缓解了这一顾虑。Element 支持精细控制每个应用程序和卷，有助于消除资源争用问题，并满足企业性能 SLA 的要求。NetApp HCI 多租户功能有助于消除许多传统的性能相关问题。



==== 灵活

前几代超融合基础架构通常需要固定的资源比率，从而将部署限制为四节点和八节点配置。NetApp HCI 是一种可独立扩展计算和存储资源的分解式超融合基础架构。独立扩展可防止成本高昂且效率低下的过度配置，消除控制器虚拟机（ VM ）开销中 10% 到 30% 的 HCI 费用，并简化容量和性能规划。NetApp HCI 提供混合搭配，小型，中型和大型存储和计算配置。

通过提供的架构设计选项，您可以自信地根据自己的需求进行扩展，从而使 HCI 适用于核心第 1 层数据中心应用程序和平台。NetApp HCI 采用机箱或节点级别的组件设计。在由存储或计算节点组成的混合配置中，每个机箱可以容纳四个节点。



==== 简单

IT 社区中的一项驱动任务是简化部署并自动执行日常任务，消除用户出错的风险，同时腾出资源来专注于更有趣，价值更高的项目。NetApp HCI 可以通过简化部署和持续管理来帮助您的 IT 部门提高灵活性和响应能力。



=== 业务价值

使用 Red Hat 产品在开源数据中心执行虚拟化的企业可以按照本文档中所述的建议设计，部署和最佳实践实现此解决方案的价值。在 NetApp HCI 上详细设置的 RHV 在作为企业虚拟化解决方案的一部分进行部署时具有以下几项优势：

* 堆栈所有层的高可用性
* 完整记录的部署过程
* 无中断运行并升级到虚拟机管理程序和管理器虚拟机
* API 驱动的可编程基础架构，便于管理
* 具有性能保证的多租户
* 能够使用企业级功能和支持基于 KVM 运行虚拟化工作负载
* 能够根据工作负载需求独立扩展基础架构


采用 Red Hat 虚拟化的 NetApp HCI 认可这些挑战，并通过实施经验证的解决方案部署架构来帮助解决每个问题。



=== 技术概述

借助适用于 Red Hat 虚拟化的 NetApp HCI ，您可以部署一个完全集成的生产级虚拟数据中心，使您能够利用以下功能：

* NetApp HCI 计算和存储节点
+
** 专为混合云工作负载设计的企业级超融合基础架构
** NetApp Element 存储软件
** 基于 Intel 的服务器计算节点，包括 NVIDIA GPU 选项


* Red Hat 虚拟化
+
** 用于部署和管理虚拟基础架构的企业级虚拟机管理程序解决方案






==== NetApp HCI

NetApp HCI 是一款企业级离散混合云基础架构（ HCI ）解决方案，可通过一个灵活，可扩展且易于管理的双机架单元（ 2RU ）四节点组件提供计算和存储资源。此外，还可以为其配置 1RU 计算和服务器节点。最低部署包含四个 NetApp HCI 存储节点和两个 NetApp HCI 计算节点。计算节点作为 RHV-H 虚拟机管理程序安装在 HA 集群中。通过添加额外的 NetApp HCI 存储或计算节点以扩展可用资源，可以轻松扩展这种最低部署规模，以满足客户企业工作负载需求。

image:redhat_virtualization_image1.png["错误：缺少图形映像"]

适用于 Red Hat 虚拟化的 NetApp HCI 设计在最低初始配置中包含以下组件：

* 运行 NetApp Element 软件的 NetApp H 系列全闪存存储节点
* 运行 Red Hat 虚拟化 RHV-H 虚拟机管理程序的 NetApp H 系列计算节点


有关 NetApp HCI 中计算和存储节点的详细信息，请参见 https://www.netapp.com/us/media/ds-3881.pdf["NetApp HCI 产品规格"^]。



==== NetApp Element 软件

NetApp Element 软件可提供模块化的可扩展性能，每个存储节点均可为环境提供有保障的容量和吞吐量。您还可以指定每个卷的存储 QoS 策略，以支持即使是要求最苛刻的工作负载也能达到专用性能级别。



===== iSCSI 登录重定向和自我修复功能

NetApp Element 软件使用 iSCSI 存储协议，这是在传统 TCP/IP 网络上封装 SCSI 命令的标准方式。当 SCSI 标准发生变化或以太网网络性能提高时， iSCSI 存储协议将受益，而无需进行任何更改。

尽管所有存储节点都有一个管理 IP 和一个存储 IP ，但 NetApp Element 软件会为集群中的所有存储流量公布一个存储虚拟 IP 地址（ SVIP 地址）。在 iSCSI 登录过程中，存储可以响应目标卷已移至其他地址，因此无法继续协商过程。然后，主机将在不需要主机端重新配置的过程中向新地址重新发出登录请求。此过程称为 iSCSI 登录重定向。

iSCSI 登录重定向是 NetApp Element 软件集群的一个关键部分。收到主机登录请求后，节点将根据 IOPS 和卷的容量要求确定集群中应由哪个成员处理流量。卷分布在 NetApp Element 软件集群中，如果单个节点处理的卷流量过多或添加了新节点，则会重新分配这些卷。给定卷的多个副本会在阵列中分配。这样，如果节点发生故障后又发生卷重新分布，则除了注销和登录并重定向到新位置之外，对主机连接不会产生任何影响。通过 iSCSI 登录重定向， NetApp Element 软件集群是一种自我修复型横向扩展架构，能够无中断升级和操作。



===== NetApp Element 软件集群 QoS

通过 NetApp Element 软件集群，可以按卷动态配置 QoS 。您可以使用每个卷的 QoS 设置根据定义的 SLA 控制存储性能。以下三个可配置参数用于定义 QoS ：

* * 最小 IOPS* 。 NetApp Element 软件集群为卷提供的最小可持续 IOPS 数。为卷配置的最小 IOPS 是卷的性能保证级别。每个卷的性能不会低于此级别。
* * 最大 IOPS* 。 NetApp Element 软件集群为特定卷提供的最大可持续 IOPS 数。
* * 突发 IOPS 。 * 在短时突发情形下允许的最大 IOPS 数。突发持续时间设置是可配置的，默认值为 1 分钟。如果卷运行的 IOPS 低于最大 IOPS 级别，则会累积突发额度。如果性能级别变得非常高并不断推送，则允许卷上的 IOPS 短时突发超过最大 IOPS 。




===== 多租户

可通过以下功能实现安全多租户：

* * 安全身份验证。 * 质询握手身份验证协议（ Challenge-Handshake Authentication Protocol ， CHAP ）用于安全卷访问。轻量级目录访问协议（ Lightweight Directory Access Protocol ， LDAP ）用于安全访问集群以进行管理和报告。
* * 卷访问组（ VAG ）。 * 也可以使用 VAG 代替身份验证，将任意数量的 iSCSI 启动程序专用 iSCSI 限定名称（ IQN ）映射到一个或多个卷。要访问 VAG 中的卷，启动程序的 IQN 必须位于该卷组允许的 IQN 列表中。
* * 租户虚拟 LAN （ VLAN ）。 * 在网络级别，使用 VLAN 可提高 iSCSI 启动程序与 NetApp Element 软件集群之间的端到端网络安全性。对于为隔离工作负载或租户而创建的任何 VLAN ， Element 软件会创建一个单独的 iSCSI 目标 SVIP 地址，该地址只能通过特定 VLAN 进行访问。
* 支持 * VPN 路由 / 转发（ VRF ）的 VLAN 。 * 为进一步支持数据中心的安全性和可扩展性， Element 软件允许您为任何租户 VLAN 启用类似 VRF 的功能。此功能增加了以下两项关键功能：
+
** 通过 * L3 路由到租户 SVIP 地址。 * 此功能，您可以将 iSCSI 启动程序置于与 NetApp Element 软件集群不同的网络或 VLAN 上。
** * IP 子网重叠或重复。 * 此功能可用于向租户环境添加模板，从而可以从同一 IP 子网为每个租户 VLAN 分配 IP 地址。此功能对于扩展和保留 IP 空间非常重要的服务提供商环境非常有用。






===== 企业级存储效率

NetApp Element 软件集群可提高整体存储效率和性能。以下功能是实时执行的，始终开启的，无需用户手动配置：

* * 重复数据删除。 * 系统仅存储唯一的 4 K 块。任何重复的 4K 块都会自动与已存储的数据版本相关联。数据位于块驱动器上，并通过 Element Helix 数据保护进行镜像。此系统可显著减少系统中的容量消耗和写入操作。
* * 压缩。 * 数据写入 NVRAM 之前，会实时执行数据压缩。数据会进行压缩，以 4 k 块的形式存储，并在系统中保持压缩状态。这种压缩可显著减少集群中的容量消耗，写入操作和带宽消耗。
* * 精简配置。 * 此功能可在需要时提供适当数量的存储，从而消除因过度配置卷或未充分利用卷而导致的容量消耗。
* * Helix.* 单个卷的元数据存储在元数据驱动器上，并复制到二级元数据驱动器以实现冗余。



NOTE: Element 专为自动化而设计。上述所有存储功能均可通过 API 进行管理。这些 API 是用户界面用于控制系统的唯一方法，可整合到用户工作流中以简化解决方案的管理。



==== Red Hat 虚拟化

Red Hat 虚拟化（ RHV ）是一个企业级虚拟数据中心平台，它使用 KVM 虚拟机管理程序在 Red Hat Enterprise Linux 上运行。

有关 Red Hat 虚拟化的详细信息，请参见位于的网站 https://www.redhat.com/en/technologies/virtualization/enterprise-virtualization["此处"^]。

RHV 具有以下功能：

* * 集中管理虚拟机和主机。 * 在部署中， RHV 管理器作为物理或虚拟机运行，并提供一个基于 Web 的图形用户界面，用于从中央界面管理解决方案。
* * 自托管引擎。 * 为最大限度地降低硬件要求， RHV 允许将 RHV Manager 部署为运行子虚拟机的同一主机上的 VM 。
* * 高可用性。 * 为避免因主机故障而造成中断， RHV 允许为虚拟机配置高可用性。高可用性 VM 可通过故障恢复策略在集群级别进行控制。
* * 高可扩展性。 * 一个 RHV 集群最多可以包含 200 个虚拟机管理程序主机，从而支持大规模虚拟机的要求，以容纳资源密集的企业级工作负载。
* * 增强的安全性。 * RHV 继承了 RHEL 的安全虚拟化（ sVirt ）和安全增强型 Linux （ SELinux ）技术，用于提高主机和 VM 的安全性和增强性能。这些功能的主要优势是对虚拟机及其相关资源进行逻辑隔离。




===== Red Hat Virtualization Manager

Red Hat Virtualization Manager （ RHV-M ）可为 RHV 虚拟化环境中的物理和逻辑资源提供集中式企业级管理。我们提供了一个基于 Web 的 GUI ，其中包含不同的基于角色的门户，用于访问 RHV-M 功能。

RHV-M 使用开源社区驱动型 RESTful API 公开对 RHV 资源的配置和管理。它还支持与 Red Hat CloudForms 和 Red Hat Ansible 实现全面集成，以实现自动化和流程编排。



===== Red Hat 虚拟化主机

主机（也称为虚拟机管理程序）是为 VM 运行提供硬件资源的物理服务器。基于内核的虚拟机（ KVM ）可提供全面的虚拟化支持，而 Virtual Desktop Server Manager （ VDSM ）是负责主机与 HVS-M 通信的主机代理

Red Hat 虚拟化中支持的两种主机类型是 Red Hat 虚拟化主机（ RHP-H ）和 Red Hat Enterprise Linux 主机（ RHEL ）。

RHV-H- H 是一款基于 Red Hat Enterprise Linux 的轻量级操作系统，经过优化，可以轻松地将物理服务器设置为 RHV 虚拟机管理程序。

RHEL 主机是运行标准 Red Hat Enterprise Linux 操作系统的服务器。然后，可以为它们配置所需的订阅，以安装允许将物理服务器用作 RHV 主机所需的软件包。



===== Red Hat 虚拟化架构

Red Hat 虚拟化可以部署在两种不同的架构中，即，将 RHV-M 作为基础架构中的物理服务器，或者将 RHV-M 配置为自托管引擎。NetApp 建议使用自托管引擎部署，其中， RHV-M 是在与其他 VM 相同的环境中托管的 VM ，如本指南所述。

要使子虚拟机和 RHV-M 实现高可用性，至少需要两个自托管节点为了为管理器 VM 提供高可用性， HA 服务将启用并在所有自行托管的引擎节点上运行。

image:redhat_virtualization_image2.png["错误：缺少图形映像"]

link:rhv-architecture_overview.html["接下来：架构概述"]
