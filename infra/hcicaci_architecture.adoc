---
sidebar: sidebar 
permalink: infra/hcicaci_architecture.html 
keywords: StorageGRID, QoS, Cisco ACI Virtual Edge, AVE, VMware distributed switch, VDS, Linux bridge, open vswitch, software, hardware, NetApp Hybrid Cloud Control, performance, interoperability, 
summary: TR-4857 
---
= 架构
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/




== 解决方案技术

本文档概述了在将 NetApp HCI 与 Cisco ACI 进行互操作时功能完备的内部数据中心或私有云应遵循的最佳实践。为了证明工作负载独立性，我们将网络最佳实践扩展到虚拟化解决方案，包括通过 NetApp HCI 部署的 VMware vSphere 和 Red Hat 虚拟化，以及其他存储解决方案，例如 NetApp ONTAP 和 StorageGRID 。同时，还强调了 Cisco ACI 交换机与不同虚拟交换机的互操作性，例如 VMware 分布式交换机（ VDS ）， Cisco ACI Virtual Edge （ Ave ）， Linux Bridge 或 Open vSwitch 。



== NetApp HCI

NetApp HCI 是一款企业级超融合基础架构解决方案，可通过一个灵活，可扩展且易于管理的架构提供计算和存储资源。运行多个企业级工作负载可能会导致资源争用，其中一个工作负载会影响另一个工作负载的性能。NetApp HCI 通过 NetApp Element 软件中本机提供的存储服务质量（ QoS ）限制缓解了这一顾虑。Element 支持精细控制每个应用程序和卷，有助于消除资源争用问题，并满足企业性能 SLA 的要求。NetApp HCI 多租户功能有助于消除许多与性能相关的传统问题。有关 NetApp HCI 的概述，请参见下图。

image:hcicaci_image1.png["错误：缺少图形映像"]

NetApp HCI 可通过 NetApp 部署引擎（ NDE ）简化安装， NDE 是一种直观的部署引擎，可自动将 400 多个输入操作设置为 30 个以下，使您的设置在大约 45 分钟内即可运行。此外，强大的 API 套件还可以无缝集成到更高级别的管理，流程编排，备份和灾难恢复工具中。借助 NetApp Hybrid Cloud Control 管理套件，您可以通过一个管理平台在整个基础架构的整个生命周期内对其进行管理，监控和升级。



=== 软件定义的架构

NetApp HCI 提供了一种软件定义的方法来部署和管理数据和存储资源。NetApp HCI 使用 NetApp Element 软件为存储自动化，配置和管理提供了一个基于图形用户界面的易于使用的门户和基于 REST 的 API 。NetApp Element 软件可提供模块化的可扩展性能，每个存储节点均可为环境提供有保障的容量和吞吐量。

NetApp HCI 使用 NetApp 部署引擎（ NDE ）自动配置和部署物理基础架构，包括安装和配置 VMware vSphere 环境以及集成适用于 vCenter Server 的 NetApp Element 插件。下图简要介绍了部署 NetApp HCI 的过程。

image:hcicaci_image2.png["错误：缺少图形映像"]



=== 性能担保

一个常见的挑战是，当多个应用程序共享同一个基础架构时，提供可预测的性能。应用程序干扰其他应用程序会导致性能下降。在共享环境中部署时，主流应用程序具有独特的 I/O 模式，这些模式可能会影响彼此的性能。为了解决这些问题， NetApp HCI 服务质量（ Quality of Service ， QoS ）功能可以精细控制每个应用程序的性能，从而消除资源争用问题并满足性能 SLA 的要求。在 NetApp HCI 中，每个卷都配置了最小，最大和突发 IOPS 值。最小 IOPS 设置可保证性能，与系统上的其他应用程序所做的工作无关。最大值和突发值用于控制分配，使系统能够为所有工作负载提供一致的性能。

NetApp Element 软件使用 iSCSI 存储协议，这是在传统 TCP/IP 网络上封装 SCSI 命令的标准方式。Element 使用一种称为 iSCSI 登录重定向的技术来提高性能。iSCSI 登录重定向是 NetApp Element 软件集群的一个关键部分。收到主机登录请求后，节点将根据 IOPS 和卷的容量要求确定集群中应由哪个成员处理流量。卷分布在 NetApp Element 软件集群中，如果单个节点处理的卷流量过多或添加了新节点，则会重新分配这些卷。给定卷的多个副本会在阵列中分配。这样，如果节点发生故障后又发生卷重新分布，则除了注销和登录并重定向到新位置之外，对主机连接不会产生任何影响。通过 iSCSI 登录重定向， NetApp Element 软件集群是一种自我修复型横向扩展架构，能够实现无中断升级和操作。



=== 互操作性

前几代超融合基础架构通常需要固定的资源比率，从而将部署限制为四节点和八节点配置。NetApp HCI 是一种可独立扩展计算和存储资源的分解式超融合基础架构。独立扩展可防止成本高昂且效率低下的过度配置，并简化容量和性能规划。

您可以通过提供的架构设计选项放心地根据自己的需求进行扩展，从而使 HCI 适用于核心第 1 层数据中心应用程序和平台。它采用机箱或节点级别的组件设计。在由存储或计算节点组成的混合配置中，每个机箱可以容纳四个节点。NetApp HCI 提供混合搭配，小型，中型和大型存储和计算配置。

NetApp HCI 提供经验证的多协议和混合云支持，并具有企业级功能。它还可以轻松地与多种不同的主机虚拟化技术和存储解决方案进行互操作性。将 ONTAP Select 和 StorageGRID 部署为设备可扩展 NetApp HCI 存储功能，包括文件，块和对象存储服务。NetApp HCI 为不同类型的虚拟数据中心提供了一个灵活的基础架构平台。VMware vSphere ， Red Hat 虚拟化， KVM ， Citrix 虚拟机管理程序等是受支持的平台，可以使用 NetApp HCI 基础架构提供可扩展的企业级内部虚拟环境。

有关详细信息，请参见 https://docs.netapp.com/hci/index.jsp["NetApp HCI 文档"^]。



== Cisco ACI

Cisco ACI 是一款行业领先的软件定义网络解决方案，可提高应用程序灵活性和数据中心自动化程度。Cisco ACI 具有一个整体架构，具有集中式策略驱动型管理。它实施了一个可编程的数据中心虚拟可扩展 LAN （ Virtual Extensible LAN ， VXLAN ）网络结构，可为任何工作负载（无论其性质如何，包括虚拟，物理，容器等）提供分布式网络连接和安全性。

Cisco 率先在数据中心引入了基于意图的 Cisco ACI 网络。它将高性能硬件和强大的软件与两个重要的 SDN 功能―叠加和集中控制相结合。ACI 网络结构由在 ACI 模式下运行的 Cisco Nexus 9000 系列交换机以及至少由三个集中管理的应用程序策略基础架构控制器（ APIC ）服务器组成的集群。下图概述了 Cisco ACI 。

image:hcicaci_image3.jpg["错误：缺少图形映像"]



=== 策略驱动型网络

Cisco ACI 采用策略驱动型模式，可使网络硬件处于无状态。应用策略基础架构控制器（ APIC ）充当中央控制器，用于管理和配置 ACI 网络结构中的所有交换机。Cisco ACI 网络结构由 Cisco Nexus 9000 系列交换机组成，这些交换机由使用声明性策略模型的 APIC 集群集中配置和管理。

Cisco ACI 使用逻辑结构形成一个分层策略架构，用于定义和管理整个网络结构的不同功能，包括基础架构，身份验证，安全性，服务， 应用程序和诊断。

下图显示了 Cisco ACI 中不同逻辑结构之间的分类和关系。

image:hcicaci_image4.jpeg["错误：缺少图形映像"]

租户是具有管理边界的逻辑容器，可执行基于域的访问控制。这是一种逻辑策略隔离，并不等同于实际的网络构造。

在租户中，环境是唯一的第 3 层转发策略域。环境可以直接映射到传统网络的虚拟路由和转发（ VRF ）概念。事实上，环境也称为 VRF 。由于每个上下文都是一个单独的第 3 层域，因此两个不同的上下文可能具有重叠的 IP 空间。

在上下文中，网桥域（ Bridge Domain ， BD ）表示唯一的第 2 层转发结构。网桥域定义唯一的第 2 层 MAC 地址空间，可等同于第 2 层洪水域或第 3 层网关。网桥域可以没有子网，但要为驻留在 BD 中的主机执行路由，它必须至少有一个子网。

在 ACI 中，端点是指在网络上进行通信的任何内容，无论是计算主机，存储设备，不属于 ACI 网络结构的网络实体，还是虚拟机等。具有相同策略要求的一组端点将归类为一个端点组（ EPG ）。EPG 用于同时配置和管理多个端点。EPG 是网桥域的成员。一个 EPG 不能是多个网桥域的成员，但多个 EPG 可以是一个网桥域的成员。

属于同一 EPG 的所有端点都可以彼此通信。但是，默认情况下，不同 EPG 中的端点无法通信，但如果两个 EPG 之间存在允许通信的合同，它们可以通信。在传统网络中，合同可以等同于 ACL 。但是，它与 ACL 不同的是，它不需要将特定 IP 地址指定为源和目标，而是将合同作为一个整体应用于 EPG 。

请参见 https://www.cisco.com/c/en/us/solutions/data-center-virtualization/application-centric-infrastructure/index.html["Cisco ACI 文档"^] 有关详细信息 ...



=== 网络优势

与传统网络相比， Cisco ACI 具有许多优势。可编程性和自动化是可扩展数据中心虚拟化基础架构的关键功能， Cisco ACI 的策略驱动机制为提供最佳物理和虚拟网络提供了大量机会。

* * 虚拟机管理器（ Virtual Machine Manager ， VMM ）集成。 * 借助 Cisco ACI 开放式 REST API 功能，可以轻松地与虚拟化环境集成。Cisco ACI 支持 VMM 与多个虚拟机管理程序集成，并可自动访问和控制虚拟机管理程序虚拟交换机以访问 ACI 中的网络结构。ACI 中的 VMM 集成可将 ACI 策略框架无缝扩展到虚拟工作负载。换句话说，通过 VMM 集成， Cisco ACI 可以控制虚拟化主机上运行的虚拟交换机，并将 ACI 网络结构访问策略扩展到虚拟工作负载。此集成还可以自动执行虚拟机管理程序的虚拟交换机部署和配置任务。Cisco ACI VMM 集成具有以下优势：
+
** 通过 APIC 为物理和虚拟环境提供单点策略管理
** 通过在虚拟环境中透明实例化应用程序，加快应用程序部署速度
** 通过跨物理和虚拟环境的整体信息聚合，全面集成地了解应用程序的运行状况
** 简化了虚拟工作负载的网络配置，因为系统会自动创建连接到 VM 所需的端口组或 VM NIC 配置文件。有关 Cisco ACI VMM 集成的详细信息，请参见 https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/1-x/aci-fundamentals/b_ACI-Fundamentals/b_ACI-Fundamentals_chapter_01011.html["Cisco 文档"^]。此外，请参见 Cisco ACI 了解版本兼容性详细信息。


* * 微分段。 * Cisco ACI 中的微分段允许您使用基于网络或基于 VM 的属性将现有应用程序 EPG 中的端点分类为微分段（ uSeg ） EPG 。这有助于更精细地筛选端点，并在这些端点上应用特定的动态策略。微分段可应用于租户中的任何端点。Cisco 支持在各种虚拟交换机上进行微分段— Cisco ACI Virtual Edge ， VMware VDS 和 Microsoft vSwitch 。可以为 uSeg EPG 配置多个属性，但一个端点只能分配给一个 EPG 。有关详细信息，请参见 https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/3-x/virtualization/Cisco-ACI-Virtualization-Guide-3-2-x/Cisco-ACI-Virtualization-Guide-3-2-x_chapter_0100.html["Cisco ACI 虚拟化指南"^] 特定版本。
* * EPG 内隔离。 * 默认情况下，属于同一 EPG 的所有端点都可以彼此通信。Cisco ACI 中的 EPG 内隔离功能可防止同一 EPG 中的端点彼此通信。它通过对从 ACI 叶到虚拟机管理程序主机以及从虚拟机管理程序主机到 ACI 叶的流量使用不同的 VLAN 来实现隔离。可以对应用程序 EPG 和微分段 EPG 强制实施 EPG 内隔离。请参见的特定版本 https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/3-x/virtualization/Cisco-ACI-Virtualization-Guide-3-2-x/Cisco-ACI-Virtualization-Guide-3-2-x_chapter_0101.html["Cisco ACI 虚拟化指南"^] 有关详细信息 ...




== 架构图

image:hcicaci_image5.jpeg["错误：缺少图形映像"]

此图显示了采用 Cisco ACI 的 NetApp HCI 的物理架构，该架构是为此解决方案设计的。通过分支连接并由三个 APIC 组成的集群管理的两个叶交换机构成了 ACI 网络结构。叶交换机连接到上游路由器以进行外部连接。三对 NetApp HCI 计算节点（每个节点都专用于虚拟机管理程序）配置有一个双缆线选项。我们为四个存储节点配置了四缆线选项，以构成 Element 集群。使用一对 AFF A200 节点为系统提供 ONTAP 功能。



== 硬件和软件要求



=== 计算

下表列出了解决方案中使用的硬件和软件计算资源。在任何解决方案实施中使用的组件可能会因客户要求而异。

|===
| 硬件 | 型号 | 数量 


| NetApp HCI 计算节点 | NetApp H410C | 6. 
|===
|===
| 软件 | 目的 | version 


| VMware ESXi | 虚拟化 | 6 ， 7. 


| VMware vCenter Server 设备 | 虚拟化管理 | 6 ， 7. 


| Red Hat Enterprise Linux | 操作系统 | 7.7 


| KVM | 虚拟化 | 1.5.3-167 


| Red Hat 虚拟化 | 虚拟化 | 4.3.9 
|===


=== 存储

下表列出了此解决方案中使用的硬件和软件存储资源。在任何特定解决方案实施中使用的组件可能会因客户要求而异。

|===
| 硬件 | 型号 | 数量 


| NetApp HCI 存储节点 | NetApp H410S | 4. 


| AFF | A200 | 2. 
|===
|===
| 软件 | 目的 | version 


| NetApp HCI | 基础架构 | 1.8 


| NetApp Element | 存储 | 12.0 


| ONTAP | 存储 | 9.7P6 


| ONTAP Select | 存储 | 9.7 


| 存储网格 | 存储 | 11.3 
|===


=== 网络

下表列出了此解决方案中使用的硬件和软件网络资源。在任何特定解决方案实施中使用的组件可能会因客户要求而异。

|===
| 硬件 | 型号 | 数量 


| Cisco UCS 服务器 | UCS C-220 M3 | 3. 


| Cisco Nexus | N9K-C936- PQ | 2. 


| Cisco Nexus | N9K-C9396-PX | 2. 
|===
|===
| 软件 | 目的 | version 


| Cisco APIC | 网络管理 | 3.2 （ 9 小时） 


| Cisco Nexus ACI 模式交换机 | 网络 | 13.2（ 9 小时） 


| Cisco AVE | 网络 | 1.2.9 


| Open vSwitch （ OVS ） | 网络 | 2.9.2 


| VMware 虚拟分布式交换机 | 网络 | 6.6 
|===
link:hcicaci_design_considerations.html["接下来：设计注意事项"]
